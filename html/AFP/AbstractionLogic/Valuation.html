<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory Valuation</title>
</head>


<body>
<div class="head">
<h1>Theory Valuation</h1>
</div>

<pre class="source"><span class="keyword1"><span class="command"><span>theory</span></span></span><span> </span><span>Valuation</span><span> </span><span class="keyword2"><span class="keyword"><span>imports</span></span></span><span> </span><a href="NTerm.html"><span>NTerm</span></a><span> </span><a href="Algebra.html"><span>Algebra</span></a><span> </span><a href="Locales.html"><span>Locales</span></a><span>
</span><span class="keyword2"><span class="keyword"><span>begin</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>section</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹</span><span>Valuation</span><span>›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹</span><span>Valuations</span><span>›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>type_synonym</span></span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><span class="entity_def" id="Valuation.valuation|type"><span>valuation</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="NTerm.html#NTerm.variable|type"><span>variable</span></a><span> </span><span class="main"><span>×</span></span><span> </span><span>nat</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><a class="entity_ref" href="Algebra.html#Algebra.operation|type"><span>operation</span></a><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Valuation.update_valuation_def|fact"><span class="entity_def" id="Valuation.update_valuation_def|thm"><span class="entity_def" id="Valuation.update_valuation_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Valuation.update_valuation|const"><span>update_valuation</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'a</span></span><span> </span><a class="entity_ref" href="Valuation.html#Valuation.valuation|type"><span>valuation</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="NTerm.html#NTerm.variable|type"><span>variable</span></a><span> </span><span>list</span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><span>list</span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><a class="entity_ref" href="Valuation.html#Valuation.valuation|type"><span>valuation</span></a><span>"</span></span></span><span> 
  </span><span class="main"><span>(</span></span><span class="quoted"><span>"</span><span>_</span><span class="keyword1"><span>{</span></span><span>_</span><span> </span><span class="keyword1"><span>:=</span></span><span> </span><span>_</span><span class="keyword1"><span>}</span></span><span>"</span></span><span> </span><span class="main"><span>[</span></span><span>1000</span><span class="main"><span>,</span></span><span> 51</span><span class="main"><span>,</span></span><span> 51</span><span class="main"><span>]</span></span><span> 1000</span><span class="main"><span>)</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="bound"><span class="entity"><span>υ</span></span></span></span><span class="main"><span class="free"><span>{</span></span></span><span class="free"><span class="bound"><span class="entity"><span>xs</span></span></span></span><span> </span><span class="main"><span class="free"><span>:=</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>us</span></span></span></span><span class="main"><span class="free"><span>}</span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>n</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> 
     </span><span class="main"><span>(</span></span><span class="keyword1"><span>if</span></span><span> </span><span class="bound"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>0</span></span><span> </span><span class="keyword1"><span>then</span></span><span> 
       </span><span class="main"><span>(</span></span><span class="keyword1"><span>case</span></span><span> </span><a class="entity_ref" href="General.html#General.index_of|const"><span>index_of</span></a><span> </span><span class="bound"><span>x</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>xs</span></span></span></span><span> </span><span class="keyword1"><span>of</span></span><span>
          Some </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="Algebra.html#Algebra.value_op|const"><span>value_op</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>us</span></span></span></span><span class="main"><span>!</span></span><span class="bound"><span>i</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> None </span><span class="main"><span>⇒</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>υ</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span>else</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>υ</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>n</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Valuation.qequal_valuation_def|fact"><span class="entity_def" id="Valuation.qequal_valuation_def|thm"><span class="entity_def" id="Valuation.qequal_valuation_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Valuation.qequal_valuation|const"><span>qequal_valuation</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="NTerm.html#NTerm.variables|type"><span>variables</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><a class="entity_ref" href="Quotients.html#Quotients.quotient|type"><span>quotient</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><a class="entity_ref" href="Valuation.html#Valuation.valuation|type"><span>valuation</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><a class="entity_ref" href="Valuation.html#Valuation.valuation|type"><span>valuation</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span>bool</span><span>"</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> 
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>qequal_valuation</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>X</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>𝒰</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>τ</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>υ</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>∀</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>X</span></span></span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>τ</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>=</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>υ</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>(mod</span></a></span><span> </span><a class="entity_ref" href="Algebra.html#Algebra.operations|const"><span>operations</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>𝒰</span></span></span></span><span> </span><span class="bound"><span>n</span></span><span class="main"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>)</span></a></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Valuation.qequal_valuation_sym|fact"><span class="entity_def" id="Valuation.qequal_valuation_sym|thm"><span>qequal_valuation_sym</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>symp</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Valuation.html#Valuation.qequal_valuation|const"><span>qequal_valuation</span></a><span> </span><span class="free"><span>X</span></span><span> </span><span class="free"><span>𝒰</span></span><span> </span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>no_types</span><span class="main"><span class="main"><span>,</span></span></span><span> lifting</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><span>case_prodD</span><span> </span><span>case_prodI2</span><span> </span><a class="entity_ref" href="Valuation.html#Valuation.qequal_valuation_def|fact"><span>qequal_valuation_def</span></a><span> </span><a class="entity_ref" href="Quotients.html#Quotients.qequals_sym|fact"><span>qequals_sym</span></a><span> </span><span>sympI</span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Valuation.qequal_valuation_trans|fact"><span class="entity_def" id="Valuation.qequal_valuation_trans|thm"><span>qequal_valuation_trans</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>transp</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Valuation.html#Valuation.qequal_valuation|const"><span>qequal_valuation</span></a><span> </span><span class="free"><span>X</span></span><span> </span><span class="free"><span>𝒰</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>smt</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> best</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><span>case_prodD</span><span> </span><span>case_prodI2</span><span> </span><a class="entity_ref" href="Valuation.html#Valuation.qequal_valuation_def|fact"><span>qequal_valuation_def</span></a><span> </span><a class="entity_ref" href="Quotients.html#Quotients.qequals_trans|fact"><span>qequals_trans</span></a><span> </span><span>transpI</span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Valuation.valuation_quotient_def|fact"><span class="entity_def" id="Valuation.valuation_quotient_def|thm"><span class="entity_def" id="Valuation.valuation_quotient_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Valuation.valuation_quotient|const"><span>valuation_quotient</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="NTerm.html#NTerm.variables|type"><span>variables</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><a class="entity_ref" href="Quotients.html#Quotients.quotient|type"><span>quotient</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><a class="entity_ref" href="Valuation.html#Valuation.valuation|type"><span>valuation</span></a><span> </span><a class="entity_ref" href="Quotients.html#Quotients.quotient|type"><span>quotient</span></a><span>"</span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>infix</span></span></span><span> </span><span class="quoted"><span>"</span><span class="keyword1"><span>↣</span></span><span>"</span></span><span> 90</span><span class="main"><span>)</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="bound"><span class="entity"><span>X</span></span></span></span><span> </span><span class="main"><span class="free"><span>↣</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>𝒰</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Quotients.html#Quotients.QuotientP|const"><span>QuotientP</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Valuation.html#Valuation.qequal_valuation|const"><span>qequal_valuation</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>X</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>𝒰</span></span></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Valuation.valuation_quotient_Rel|fact"><span class="entity_def" id="Valuation.valuation_quotient_Rel|thm"><span>valuation_quotient_Rel</span></span></span><span class="main"><span>:</span></span><span> 
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Quotients.html#Quotients.quotient.Rel|const"><span>Rel</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>X</span></span><span> </span><span class="main"><a class="entity_ref" href="Valuation.html#Valuation.valuation_quotient|const"><span>↣</span></a></span><span> </span><span class="free"><span>𝒰</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>τ</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>υ</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Valuation.html#Valuation.qequal_valuation|const"><span>qequal_valuation</span></a><span> </span><span class="free"><span>X</span></span><span> </span><span class="free"><span>𝒰</span></span><span> </span><span class="bound"><span>τ</span></span><span> </span><span class="bound"><span>υ</span></span><span> </span><span class="main"><span>}</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Quotients.html#Quotients.QuotientP_Rel|fact"><span>QuotientP_Rel</span></a><span> </span><a class="entity_ref" href="Valuation.html#Valuation.qequal_valuation_sym|fact"><span>qequal_valuation_sym</span></a><span> </span><a class="entity_ref" href="Valuation.html#Valuation.qequal_valuation_trans|fact"><span>qequal_valuation_trans</span></a><span> </span><a class="entity_ref" href="Valuation.html#Valuation.valuation_quotient_def|fact"><span>valuation_quotient_def</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Valuation.valuation_quotient_mod|fact"><span class="entity_def" id="Valuation.valuation_quotient_mod|thm"><span>valuation_quotient_mod</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>τ</span></span><span> </span><span class="main"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>=</span></a></span><span> </span><span class="free"><span>υ</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>(mod</span></a></span><span> </span><span class="free"><span>X</span></span><span> </span><span class="main"><a class="entity_ref" href="Valuation.html#Valuation.valuation_quotient|const"><span>↣</span></a></span><span> </span><span class="free"><span>𝒰</span></span><span class="main"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>)</span></a></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Valuation.html#Valuation.qequal_valuation|const"><span>qequal_valuation</span></a><span> </span><span class="free"><span>X</span></span><span> </span><span class="free"><span>𝒰</span></span><span> </span><span class="free"><span>τ</span></span><span> </span><span class="free"><span>υ</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Quotients.html#Quotients.QuotientP_mod|fact"><span>QuotientP_mod</span></a><span> </span><a class="entity_ref" href="Valuation.html#Valuation.qequal_valuation_sym|fact"><span>qequal_valuation_sym</span></a><span> </span><a class="entity_ref" href="Valuation.html#Valuation.qequal_valuation_trans|fact"><span>qequal_valuation_trans</span></a><span> </span><a class="entity_ref" href="Valuation.html#Valuation.valuation_quotient_def|fact"><span>valuation_quotient_def</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Valuation.valuation_quotient_in|fact"><span class="entity_def" id="Valuation.valuation_quotient_in|thm"><span>valuation_quotient_in</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>υ</span></span><span> </span><span class="main"><a class="entity_ref" href="Quotients.html#Quotients.qin|const"><span>/∈</span></a></span><span> </span><span class="free"><span>X</span></span><span> </span><span class="main"><a class="entity_ref" href="Valuation.html#Valuation.valuation_quotient|const"><span>↣</span></a></span><span> </span><span class="free"><span>𝒰</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Valuation.html#Valuation.qequal_valuation|const"><span>qequal_valuation</span></a><span> </span><span class="free"><span>X</span></span><span> </span><span class="free"><span>𝒰</span></span><span> </span><span class="free"><span>υ</span></span><span> </span><span class="free"><span>υ</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Quotients.html#Quotients.qin_mod|fact"><span>qin_mod</span></a><span> </span><a class="entity_ref" href="Valuation.html#Valuation.valuation_quotient_mod|fact"><span>valuation_quotient_mod</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Valuation.valuation_quotient_app|fact"><span class="entity_def" id="Valuation.valuation_quotient_app|thm"><span>valuation_quotient_app</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>τ</span></span><span> </span><span class="main"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>=</span></a></span><span> </span><span class="free"><span>υ</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>(mod</span></a></span><span> </span><span class="free"><span>X</span></span><span> </span><span class="main"><a class="entity_ref" href="Valuation.html#Valuation.valuation_quotient|const"><span>↣</span></a></span><span> </span><span class="free"><span>𝒰</span></span><span class="main"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>)</span></a></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="free"><span>X</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>us</span></span><span> </span><span class="main"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>=</span></a></span><span> </span><span class="free"><span>vs</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>(mod</span></a></span><span> </span><span class="free"><span>𝒰</span></span><span> </span><span class="main"><a class="entity_ref" href="Quotients.html#Quotients.vector_quotient|const"><span>/^</span></a></span><span> </span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>)</span></a></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>τ</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>us</span></span><span> </span><span class="main"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>=</span></a></span><span> </span><span class="free"><span>υ</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>vs</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>(mod</span></a></span><span> </span><span class="free"><span>𝒰</span></span><span class="main"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>)</span></a></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>no_types</span><span class="main"><span class="main"><span>,</span></span></span><span> lifting</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Quotients.html#Quotients.QuotientP_mod|fact"><span>QuotientP_mod</span></a><span> </span><span>case_prodD</span><span> </span><a class="entity_ref" href="Quotients.html#Quotients.fun_quotient_app_mod|fact"><span>fun_quotient_app_mod</span></a><span> </span><a class="entity_ref" href="Algebra.html#Algebra.operations_def|fact"><span>operations_def</span></a><span> 
      </span><a class="entity_ref" href="Valuation.html#Valuation.qequal_valuation_def|fact"><span>qequal_valuation_def</span></a><span> </span><a class="entity_ref" href="Valuation.html#Valuation.qequal_valuation_sym|fact"><span>qequal_valuation_sym</span></a><span> </span><a class="entity_ref" href="Valuation.html#Valuation.qequal_valuation_trans|fact"><span>qequal_valuation_trans</span></a><span> </span><a class="entity_ref" href="Valuation.html#Valuation.valuation_quotient_def|fact"><span>valuation_quotient_def</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Valuation.valuation_mod_subdomain|fact"><span class="entity_def" id="Valuation.valuation_mod_subdomain|thm"><span>valuation_mod_subdomain</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>mod</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>τ</span></span><span> </span><span class="main"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>=</span></a></span><span> </span><span class="free"><span>υ</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>(mod</span></a></span><span> </span><span class="free"><span>X</span></span><span> </span><span class="main"><a class="entity_ref" href="Valuation.html#Valuation.valuation_quotient|const"><span>↣</span></a></span><span> </span><span class="free"><span>𝒰</span></span><span class="main"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>)</span></a></span><span>"</span></span></span><span> 
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>sub</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>Y</span></span><span> </span><span class="main"><span>⊆</span></span><span> </span><span class="free"><span>X</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>τ</span></span><span> </span><span class="main"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>=</span></a></span><span> </span><span class="free"><span>υ</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>(mod</span></a></span><span> </span><span class="free"><span>Y</span></span><span> </span><span class="main"><a class="entity_ref" href="Valuation.html#Valuation.valuation_quotient|const"><span>↣</span></a></span><span> </span><span class="free"><span>𝒰</span></span><span class="main"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>)</span></a></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>∀</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="free"><span>X</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>τ</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>=</span></a></span><span> </span><span class="free"><span>υ</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>(mod</span></a></span><span> </span><a class="entity_ref" href="Algebra.html#Algebra.operations|const"><span>operations</span></a><span> </span><span class="free"><span>𝒰</span></span><span> </span><span class="bound"><span>n</span></span><span class="main"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>)</span></a></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>mod</span><span> 
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Valuation.html#Valuation.qequal_valuation_def|fact"><span>qequal_valuation_def</span></a><span> </span><a class="entity_ref" href="Valuation.html#Valuation.valuation_quotient_mod|fact"><span>valuation_quotient_mod</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>meson</span></span><span> </span><span>mod</span><span> </span><a class="entity_ref" href="Valuation.html#Valuation.qequal_valuation_def|fact"><span>qequal_valuation_def</span></a><span> </span><span>sub</span><span> </span><span>subset_iff</span><span> </span><a class="entity_ref" href="Valuation.html#Valuation.valuation_quotient_mod|fact"><span>valuation_quotient_mod</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Valuation.update_valuation_skipvar|fact"><span class="entity_def" id="Valuation.update_valuation_skipvar|thm"><span>update_valuation_skipvar</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>x</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>x</span></span><span> </span><span class="main"><span>∉</span></span><span> </span><span>set</span><span> </span><span class="free"><span>xs</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>υ</span></span><span class="main"><a class="entity_ref" href="Valuation.html#Valuation.update_valuation|const"><span>{</span></a></span><span class="free"><span>xs</span></span><span> </span><span class="main"><a class="entity_ref" href="Valuation.html#Valuation.update_valuation|const"><span>:=</span></a></span><span> </span><span class="free"><span>us</span></span><span class="main"><a class="entity_ref" href="Valuation.html#Valuation.update_valuation|const"><span>}</span></a></span><span class="main"><span>(</span></span><span class="free"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>υ</span></span><span class="main"><span>(</span></span><span class="free"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>n</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span> 
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="General.html#General.index_of|const"><span>index_of</span></a><span> </span><span class="free"><span>x</span></span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>None</span><span>"</span></span></span><span> 
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="General.html#General.index_of_is_Some|fact"><span>index_of_is_Some</span></a><span> </span><span>nth_mem</span><span> </span><span>option.exhaust</span><span> </span><span>x</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> 
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Valuation.html#Valuation.update_valuation_def|fact"><span>update_valuation_def</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Valuation.subtracted_bound_vars|fact"><span class="entity_def" id="Valuation.subtracted_bound_vars|thm"><span>subtracted_bound_vars</span></span></span><span class="main"><span>:</span></span><span> 
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>x</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="free"><span>X</span></span><span> </span><span class="main"><span>-</span></span><span> </span><span class="free"><span>xs</span></span><span class="main"><a class="entity_ref" href="NTerm.html#NTerm.binders_as_vars|const"><span>`,0</span></a></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>n</span></span><span> </span><span class="main"><span>&gt;</span></span><span> </span><span class="main"><span>0</span></span><span> </span><span class="main"><span>∨</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>∉</span></span><span> </span><span>set</span><span> </span><span class="free"><span>xs</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>x</span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="NTerm.html#NTerm.binders_as_vars_def|fact"><span>binders_as_vars_def</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Valuation.update_valuation_eq_intro|fact"><span class="entity_def" id="Valuation.update_valuation_eq_intro|thm"><span>update_valuation_eq_intro</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>τ</span></span><span> </span><span class="main"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>=</span></a></span><span> </span><span class="free"><span>υ</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>(mod</span></a></span><span> </span><span class="free"><span>X</span></span><span> </span><span class="main"><a class="entity_ref" href="Valuation.html#Valuation.valuation_quotient|const"><span>↣</span></a></span><span> </span><span class="free"><span>𝒰</span></span><span class="main"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>)</span></a></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>us</span></span><span> </span><span class="main"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>=</span></a></span><span> </span><span class="free"><span>vs</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>(mod</span></a></span><span> </span><span class="free"><span>𝒰</span></span><span class="main"><a class="entity_ref" href="Quotients.html#Quotients.vector_quotient|const"><span>/^</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>)</span></a></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>length</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span>  
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>τ</span></span><span class="main"><a class="entity_ref" href="Valuation.html#Valuation.update_valuation|const"><span>{</span></a></span><span class="free"><span>xs</span></span><span> </span><span class="main"><a class="entity_ref" href="Valuation.html#Valuation.update_valuation|const"><span>:=</span></a></span><span> </span><span class="free"><span>us</span></span><span class="main"><a class="entity_ref" href="Valuation.html#Valuation.update_valuation|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>=</span></a></span><span> </span><span class="free"><span>υ</span></span><span class="main"><a class="entity_ref" href="Valuation.html#Valuation.update_valuation|const"><span>{</span></a></span><span class="free"><span>xs</span></span><span> </span><span class="main"><a class="entity_ref" href="Valuation.html#Valuation.update_valuation|const"><span>:=</span></a></span><span> </span><span class="free"><span>vs</span></span><span class="main"><a class="entity_ref" href="Valuation.html#Valuation.update_valuation|const"><span>}</span></a></span><span> </span><span class="keyword1"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>(mod</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>X</span></span><span> </span><span class="main"><span>∪</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="NTerm.html#NTerm.binders_as_vars|const"><span>`,0</span></a></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="Valuation.html#Valuation.valuation_quotient|const"><span>↣</span></a></span><span> </span><span class="free"><span>𝒰</span></span><span class="main"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>)</span></a></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>{</span></span></span><span> 
    </span><span class="keyword3"><span class="command"><span>fix</span></span></span><span> </span><span class="skolem"><span>x</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><a class="entity_ref" href="NTerm.html#NTerm.variable|type"><span>variable</span></a></span><span>
    </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>x</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span>set</span><span> </span><span class="free"><span>xs</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>∃</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="General.html#General.index_of|const"><span>index_of</span></a><span> </span><span class="skolem"><span>x</span></span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Some</span><span> </span><span class="bound"><span>i</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="General.html#General.index_of_exists|fact"><span>index_of_exists</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>i</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span>i</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="General.html#General.index_of|const"><span>index_of</span></a><span> </span><span class="skolem"><span>x</span></span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Some</span><span> </span><span class="skolem"><span>i</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
    </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>i</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> 
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>assms</span><span class="main"><span>(</span></span><span>3</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="General.html#General.index_of_is_Some|fact"><span>index_of_is_Some</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>fastforce</span></span><span>
    </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span>us_vs_eq_at_i</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>us</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="skolem"><span>i</span></span><span> </span><span class="main"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>=</span></a></span><span> </span><span class="free"><span>vs</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="skolem"><span>i</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>(mod</span></a></span><span> </span><span class="free"><span>𝒰</span></span><span class="main"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>)</span></a></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>assms</span><span class="main"><span>(</span></span><span>2</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Quotients.html#Quotients.vector_quotient_nth_mod|fact"><span>vector_quotient_nth_mod</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>τ</span></span><span class="main"><a class="entity_ref" href="Valuation.html#Valuation.update_valuation|const"><span>{</span></a></span><span class="free"><span>xs</span></span><span> </span><span class="main"><a class="entity_ref" href="Valuation.html#Valuation.update_valuation|const"><span>:=</span></a></span><span> </span><span class="free"><span>us</span></span><span class="main"><a class="entity_ref" href="Valuation.html#Valuation.update_valuation|const"><span>}</span></a></span><span class="main"><span>(</span></span><span class="skolem"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>0</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>=</span></a></span><span> </span><span class="free"><span>υ</span></span><span class="main"><a class="entity_ref" href="Valuation.html#Valuation.update_valuation|const"><span>{</span></a></span><span class="free"><span>xs</span></span><span> </span><span class="main"><a class="entity_ref" href="Valuation.html#Valuation.update_valuation|const"><span>:=</span></a></span><span> </span><span class="free"><span>vs</span></span><span class="main"><a class="entity_ref" href="Valuation.html#Valuation.update_valuation|const"><span>}</span></a></span><span class="main"><span>(</span></span><span class="skolem"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>0</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>(mod</span></a></span><span> </span><a class="entity_ref" href="Algebra.html#Algebra.operations|const"><span>operations</span></a><span> </span><span class="free"><span>𝒰</span></span><span> </span><span class="main"><span>0</span></span><span class="main"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>)</span></a></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Valuation.html#Valuation.update_valuation_def|fact"><span>update_valuation_def</span></a><span> </span><span>i</span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>us_vs_eq_at_i</span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Algebra.html#Algebra.operations_eq_intro|fact"><span>operations_eq_intro</span></a><span> </span><a class="entity_ref" href="Algebra.html#Algebra.value_op_def|fact"><span>value_op_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>}</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>note</span></span></span><span> </span><span>main</span><span> </span><span class="main"><span>=</span></span><span> </span><span>this</span><span>
  </span><span class="keyword1"><span class="command"><span>{</span></span></span><span>
    </span><span class="keyword3"><span class="command"><span>fix</span></span></span><span> </span><span class="skolem"><span>x</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><a class="entity_ref" href="NTerm.html#NTerm.variable|type"><span>variable</span></a></span><span>
    </span><span class="keyword3"><span class="command"><span>fix</span></span></span><span> </span><span class="skolem"><span>n</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span>nat</span></span><span>
    </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span>xn</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="skolem"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="skolem"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="free"><span>X</span></span><span> </span><span class="main"><span>-</span></span><span> </span><span class="free"><span>xs</span></span><span class="main"><a class="entity_ref" href="NTerm.html#NTerm.binders_as_vars|const"><span>`,0</span></a></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span>x_or_n</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>x</span></span><span> </span><span class="main"><span>∉</span></span><span> </span><span>set</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>∨</span></span><span> </span><span class="skolem"><span>n</span></span><span> </span><span class="main"><span>&gt;</span></span><span> </span><span class="main"><span>0</span></span><span>"</span></span></span><span> 
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Valuation.html#Valuation.subtracted_bound_vars|fact"><span>subtracted_bound_vars</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>τ</span></span><span class="main"><a class="entity_ref" href="Valuation.html#Valuation.update_valuation|const"><span>{</span></a></span><span class="free"><span>xs</span></span><span> </span><span class="main"><a class="entity_ref" href="Valuation.html#Valuation.update_valuation|const"><span>:=</span></a></span><span> </span><span class="free"><span>us</span></span><span class="main"><a class="entity_ref" href="Valuation.html#Valuation.update_valuation|const"><span>}</span></a></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="skolem"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>=</span></a></span><span> </span><span class="free"><span>υ</span></span><span class="main"><a class="entity_ref" href="Valuation.html#Valuation.update_valuation|const"><span>{</span></a></span><span class="free"><span>xs</span></span><span> </span><span class="main"><a class="entity_ref" href="Valuation.html#Valuation.update_valuation|const"><span>:=</span></a></span><span> </span><span class="free"><span>vs</span></span><span class="main"><a class="entity_ref" href="Valuation.html#Valuation.update_valuation|const"><span>}</span></a></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="skolem"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>(mod</span></a></span><span> </span><a class="entity_ref" href="Algebra.html#Algebra.operations|const"><span>operations</span></a><span> </span><span class="free"><span>𝒰</span></span><span> </span><span class="skolem"><span>n</span></span><span class="main"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>)</span></a></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>smt</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> ccfv_threshold</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><span>DiffE</span><span> </span><span>assms</span><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><span>not_gr0</span><span> </span><a class="entity_ref" href="Algebra.html#Algebra.operations_mod|fact"><span>operations_mod</span></a><span> </span><span>prod.simps</span><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> 
          </span><a class="entity_ref" href="Valuation.html#Valuation.update_valuation_def|fact"><span>update_valuation_def</span></a><span> </span><a class="entity_ref" href="Valuation.html#Valuation.update_valuation_skipvar|fact"><span>update_valuation_skipvar</span></a><span> </span><a class="entity_ref" href="Valuation.html#Valuation.valuation_quotient_app|fact"><span>valuation_quotient_app</span></a><span> </span><span>x_or_n</span><span> </span><span>xn</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>}</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>note</span></span></span><span> </span><span>simple</span><span> </span><span class="main"><span>=</span></span><span> </span><span>this</span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> 
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Valuation.html#Valuation.valuation_quotient_mod|fact"><span>valuation_quotient_mod</span></a><span> </span><a class="entity_ref" href="Valuation.html#Valuation.qequal_valuation_def|fact"><span>qequal_valuation_def</span></a><span class="main"><span>)</span></span><span>  
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>main</span><span> </span><span>simple</span><span> </span><a class="entity_ref" href="NTerm.html#NTerm.binders_as_vars_def|fact"><span>binders_as_vars_def</span></a><span>  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>fastforce</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Valuation.valuations_empty_domain|fact"><span class="entity_def" id="Valuation.valuations_empty_domain|thm"><span>valuations_empty_domain</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>{}</span></span><span> </span><span class="main"><a class="entity_ref" href="Valuation.html#Valuation.valuation_quotient|const"><span>↣</span></a></span><span> </span><span class="free"><span>𝒰</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Quotients.html#Quotients.universal_singleton_quotient|const"><span>/𝟭𝒰</span></a></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>meson</span></span><span> </span><span>equals0D</span><span> </span><a class="entity_ref" href="Valuation.html#Valuation.qequal_valuation_def|fact"><span>qequal_valuation_def</span></a><span> </span><a class="entity_ref" href="Quotients.html#Quotients.qsubset_antisym_weak|fact"><span>qsubset_antisym_weak</span></a><span> </span><a class="entity_ref" href="Quotients.html#Quotients.qsubset_weak_def|fact"><span>qsubset_weak_def</span></a><span> 
      </span><a class="entity_ref" href="Quotients.html#Quotients.subset_universal_singleton_weak|fact"><span>subset_universal_singleton_weak</span></a><span> </span><a class="entity_ref" href="Valuation.html#Valuation.valuation_quotient_mod|fact"><span>valuation_quotient_mod</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹</span><span>Evaluation</span><span>›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>context</span></span></span><span> </span><a class="entity_ref" href="Locales.html#Locales.algloc|locale"><span>algloc</span></a><span>
</span><span class="keyword2"><span class="keyword"><span>begin</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>abbreviation</span></span></span><span> </span><span class="entity"><span class="entity_def" id="Valuation.algloc.Valuations|const"><span>Valuations</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="NTerm.html#NTerm.variables|type"><span>variables</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><a class="entity_ref" href="Valuation.html#Valuation.valuation|type"><span>valuation</span></a><span> </span><a class="entity_ref" href="Quotients.html#Quotients.quotient|type"><span>quotient</span></a><span>"</span></span></span><span> </span><span class="main"><span>(</span></span><span class="quoted"><span>"</span><span class="keyword1"><span>𝕍</span></span><span>"</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span class="free"><span>𝕍</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>X</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>X</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="Valuation.html#Valuation.valuation_quotient|const"><span>↣</span></a></span><span> </span><span class="keyword1"><span>𝒰</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Valuation.algloc.eval.elims|fact"><span class="entity_def" id="Valuation.algloc.eval.induct|fact"><span class="entity_def" id="Valuation.algloc.eval.simps|fact"><span class="entity_def" id="Valuation.algloc.eval.pelims|fact"><span class="entity_def" id="Valuation.algloc.eval.cases|fact"><span class="entity_def" id="Valuation.algloc.eval.termination|fact"><span class="entity_def" id="Valuation.algloc.eval.pinduct|fact"><span class="entity_def" id="Valuation.algloc.eval.psimps|fact"><span class="entity_def" id="Valuation.algloc.eval_rel.inducts|fact"><span class="entity_def" id="Valuation.algloc.eval_rel.simps|fact"><span class="entity_def" id="Valuation.algloc.eval_rel.induct|fact"><span class="entity_def" id="Valuation.algloc.eval_rel.cases|fact"><span class="entity_def" id="Valuation.algloc.eval_rel.intros|fact"><span class="entity_def" id="Valuation.algloc.eval_rel.cong|fact"><span class="entity_def" id="Valuation.algloc.eval_sumC.cong|fact"><span class="entity_def" id="Valuation.algloc.eval_graph.inducts|fact"><span class="entity_def" id="Valuation.algloc.eval_graph.simps|fact"><span class="entity_def" id="Valuation.algloc.eval_graph.induct|fact"><span class="entity_def" id="Valuation.algloc.eval_graph.cases|fact"><span class="entity_def" id="Valuation.algloc.eval_graph.intros|fact"><span class="entity_def" id="Valuation.algloc.eval_graph.cong|fact"><span class="entity_def" id="Valuation.algloc.eval.elims|thm"><span class="entity_def" id="Valuation.algloc.eval.induct|thm"><span class="entity_def" id="Valuation.algloc.eval.simps(2)|thm"><span class="entity_def" id="Valuation.algloc.eval.simps(1)|thm"><span class="entity_def" id="Valuation.algloc.eval.pelims|thm"><span class="entity_def" id="Valuation.algloc.eval.cases|thm"><span class="entity_def" id="Valuation.algloc.eval.termination|thm"><span class="entity_def" id="Valuation.algloc.eval.pinduct|thm"><span class="entity_def" id="Valuation.algloc.eval.psimps(2)|thm"><span class="entity_def" id="Valuation.algloc.eval.psimps(1)|thm"><span class="entity_def" id="Valuation.algloc.eval_rel.inducts|thm"><span class="entity_def" id="Valuation.algloc.eval_rel.simps|thm"><span class="entity_def" id="Valuation.algloc.eval_rel.induct|thm"><span class="entity_def" id="Valuation.algloc.eval_rel.cases|thm"><span class="entity_def" id="Valuation.algloc.eval_rel.intros(2)|thm"><span class="entity_def" id="Valuation.algloc.eval_rel.intros(1)|thm"><span class="entity_def" id="Valuation.algloc.eval_rel.cong|thm"><span class="entity_def" id="Valuation.algloc.eval_sumC.cong|thm"><span class="entity_def" id="Valuation.algloc.eval_graph.inducts|thm"><span class="entity_def" id="Valuation.algloc.eval_graph.simps|thm"><span class="entity_def" id="Valuation.algloc.eval_graph.induct|thm"><span class="entity_def" id="Valuation.algloc.eval_graph.cases|thm"><span class="entity_def" id="Valuation.algloc.eval_graph.intros(2)|thm"><span class="entity_def" id="Valuation.algloc.eval_graph.intros(1)|thm"><span class="entity_def" id="Valuation.algloc.eval_graph.cong|thm"><span class="entity_def" id="Valuation.algloc.eval_def|axiom"><span class="entity_def" id="Valuation.algloc.eval_rel_def|axiom"><span class="entity_def" id="Valuation.algloc.eval_sumC_def|axiom"><span class="entity_def" id="Valuation.algloc.eval_graph_def|axiom"><span class="entity_def" id="Valuation.algloc.eval_dom|const"><span class="entity_def" id="Valuation.algloc.eval_rel|const"><span class="entity_def" id="Valuation.algloc.eval_sumC|const"><span class="entity_def" id="Valuation.algloc.eval_graph|const"><span>fun</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Valuation.algloc.eval.cong|fact"><span class="entity_def" id="Valuation.algloc.eval.cong|thm"><span class="entity_def" id="Valuation.algloc.eval|const"><span>eval</span></span></span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="NTerm.html#NTerm.nterm|type"><span>nterm</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><a class="entity_ref" href="Valuation.html#Valuation.valuation|type"><span>valuation</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'a</span></span><span>"</span></span></span><span> </span><span class="main"><span>(</span></span><span class="quoted"><span>"</span><span class="keyword1"><span>⟨</span></span><span>_</span><span class="keyword1"><span>;</span></span><span> </span><span>_</span><span class="keyword1"><span>⟩</span></span><span>"</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>eval</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="NTerm.html#NTerm.nterm.VarApp|const"><span>VarApp</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>ts</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>υ</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>υ</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span class="main"><span>,</span></span><span> </span><span>length</span><span> </span><span class="free"><span class="bound"><span class="entity"><span>ts</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span>§map</span></span><span> </span><span class="bound"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>ts</span></span></span></span><span class="main"><span>!</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>eval</span></span><span> </span><span class="bound"><span>t</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>υ</span></span></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="main"><span>|</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>eval</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="NTerm.html#NTerm.nterm.AbsApp|const"><span>AbsApp</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>xs</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>ts</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>υ</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span>𝒪</span></span><span> </span><span class="main"><a class="entity_ref" href="General.html#General.map_forced_get|const"><span>!!</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span>§map</span></span><span> </span><span class="bound"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>ts</span></span></span></span><span class="main"><span>!</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> 
       </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span> </span><span class="bound"><span>us</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>eval</span></span><span> </span><span class="bound"><span>t</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>υ</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="Valuation.html#Valuation.update_valuation|const"><span>{</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span class="main"><span>!@</span></span><span class="bound"><span>i</span></span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>xs</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="Valuation.html#Valuation.update_valuation|const"><span>:=</span></a></span><span> </span><span class="bound"><span>us</span></span><span> </span><span class="main"><a class="entity_ref" href="Valuation.html#Valuation.update_valuation|const"><span>}</span></a></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Valuation.algloc.eval_modulo|fact"><span class="entity_def" id="Valuation.algloc.eval_modulo|thm"><span>eval_modulo</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span>wf</span><span> </span><span class="free"><span>t</span></span><span> </span><span class="main"><span>⟹</span></span><span> 
   </span><span>frees</span><span> </span><span class="free"><span>t</span></span><span> </span><span class="main"><span>⊆</span></span><span> </span><span class="free"><span>X</span></span><span> </span><span class="main"><span>⟹</span></span><span>
   </span><span class="free"><span>τ</span></span><span> </span><span class="main"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>=</span></a></span><span> </span><span class="free"><span>υ</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>(mod</span></a></span><span> </span><span class="main"><span>𝕍</span></span><span> </span><span class="free"><span>X</span></span><span class="main"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>)</span></a></span><span> </span><span class="main"><span>⟹</span></span><span> 
   </span><span>eval</span><span> </span><span class="free"><span>t</span></span><span> </span><span class="free"><span>τ</span></span><span> </span><span class="main"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>=</span></a></span><span> </span><span>eval</span><span> </span><span class="free"><span>t</span></span><span> </span><span class="free"><span>υ</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>(mod</span></a></span><span> </span><span class="keyword1"><span>𝒰</span></span><span class="main"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>)</span></a></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>induct</span></span><span> </span><span class="quoted"><span class="free"><span>t</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>τ</span></span></span><span> </span><span class="quoted"><span class="free"><span>υ</span></span></span><span> </span><span class="quoted"><span class="free"><span>X</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span>VarApp</span><span> </span><span class="skolem"><span>x</span></span><span> </span><span class="skolem"><span>ts</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span>τ_eq_υ</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>τ</span></span><span> </span><span class="main"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>=</span></a></span><span> </span><span class="skolem"><span>υ</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>(mod</span></a></span><span> </span><span class="main"><span>𝕍</span></span><span> </span><span class="skolem"><span>X</span></span><span class="main"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>)</span></a></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>VarApp</span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
  </span><span class="keyword1"><span class="command"><span>thm</span></span></span><span> </span><a class="entity_ref" href="Valuation.html#Valuation.valuation_quotient_app|fact"><span>valuation_quotient_app</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><span>τ_eq_υ</span><span class="main"><span>]</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>frees</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="NTerm.html#NTerm.nterm.VarApp|const"><span>VarApp</span></a><span> </span><span class="skolem"><span>x</span></span><span> </span><span class="skolem"><span>ts</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⊆</span></span><span> </span><span class="skolem"><span>X</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>VarApp</span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>force</span></span><span>
  </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span>xInX</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="skolem"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span>length</span><span> </span><span class="skolem"><span>ts</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="skolem"><span>X</span></span><span>"</span></span></span><span> 
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="NTerm.html#NTerm.nt_free_VarApp|fact"><span>nt_free_VarApp</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>force</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span>frees_sub</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span>length</span><span> </span><span class="skolem"><span>ts</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span>frees</span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>ts</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⊆</span></span><span> </span><span class="skolem"><span>X</span></span><span>"</span></span></span><span> 
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>VarApp.prems</span><span class="main"><span>(</span></span><span>2</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="NTerm.html#NTerm.nt_free_VarApp_arg_subset|fact"><span>nt_free_VarApp_arg_subset</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>presburger</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> 
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="General.html#General.list_unindexed_map|fact"><span>list_unindexed_map</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="Valuation.html#Valuation.valuation_quotient_app|fact"><span>valuation_quotient_app</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><span class="operator"><span>where</span></span></span></span><span> X</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span>X</span></span></span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>τ_eq_υ</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>xInX</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>subst</span></span><span> </span><a class="entity_ref" href="Quotients.html#Quotients.vector_quotient_mod|fact"><span>vector_quotient_mod</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Quotients.html#Quotients.qequal_vector_def|fact"><span>qequal_vector_def</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><span>VarApp.hyps</span><span> </span><span>VarApp.prems</span><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><span>VarApp.prems</span><span class="main"><span class="main"><span>(</span></span></span><span>3</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><span>frees_sub</span><span> </span><span>nth_mem</span><span> </span><span>wf_VarApp</span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span>AbsApp</span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="skolem"><span>xs</span></span><span> </span><span class="skolem"><span>ts</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span>valid</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>✓</span></span><span class="skolem"><span>a</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>AbsApp</span><span> </span><span>wf_implies_valid_abs</span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span>len_ts</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>length</span><span> </span><span class="skolem"><span>ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Shape.html#Shape.shape_arity|const"><span>§ar</span></a></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span>𝒮</span></span><span> </span><span class="main"><a class="entity_ref" href="General.html#General.map_forced_get|const"><span>!!</span></a></span><span> </span><span class="skolem"><span>a</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>smt</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>z3</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><span>AbsApp.prems</span><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="General.html#General.map_forced_get_def|fact"><span>map_forced_get_def</span></a><span> </span><a class="entity_ref" href="NTerm.html#NTerm.nt_wf.simps|fact"><span>nt_wf.simps</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><span>option.case_eq_if</span><span> </span><a class="entity_ref" href="Signature.html#Signature.sig_contains_def|fact"><span>sig_contains_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span>frees</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span>length</span><span> </span><span class="skolem"><span>ts</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span>frees</span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>ts</span></span><span class="main"><span>!</span></span><span class="bound"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⊆</span></span><span> </span><span class="skolem"><span>X</span></span><span> </span><span class="main"><span>∪</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>a</span></span><span class="main"><span>!@</span></span><span class="bound"><span>i</span></span><span class="main"><span>(</span></span><span class="skolem"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="NTerm.html#NTerm.binders_as_vars|const"><span>`,0</span></a></span><span>"</span></span></span><span> 
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>AbsApp.prems</span><span class="main"><span>(</span></span><span>2</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="NTerm.html#NTerm.nt_free_ConsApp_arg_subset|fact"><span>nt_free_ConsApp_arg_subset</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="Algebra.html#Algebra.operator_appeq_intro|fact"><span>operator_appeq_intro</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>valid_in_operators</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>valid</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span>len_ts</span><span class="main"><span>)</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span>len_ts</span><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>symmetric</span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="Algebra.html#Algebra.operations_eq_intro|fact"><span>operations_eq_intro</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>AbsApp</span><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>force</span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>AbsApp.prems</span><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>auto</span></span><span class="main"><span class="keyword3"><span>[</span></span></span><span>1</span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>frees</span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="Valuation.html#Valuation.update_valuation_eq_intro|fact"><span>update_valuation_eq_intro</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>AbsApp</span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>valid</span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>length_boundvars_at</span><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><span>AbsApp</span><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Valuation.algloc.eval_is_fun_modulo|fact"><span class="entity_def" id="Valuation.algloc.eval_is_fun_modulo|thm"><span>eval_is_fun_modulo</span></span></span><span class="main"><span>:</span></span><span> 
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>wf</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>wf</span><span> </span><span class="free"><span>t</span></span><span>"</span></span></span><span> 
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>eval</span><span> </span><span class="free"><span>t</span></span><span> </span><span class="main"><a class="entity_ref" href="Quotients.html#Quotients.qin|const"><span>/∈</span></a></span><span> </span><span class="main"><span>𝕍</span></span><span> </span><span class="main"><span>(</span></span><span>frees</span><span> </span><span class="free"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="Quotients.html#Quotients.fun_quotient|const"><span>/⇒</span></a></span><span> </span><span class="keyword1"><span>𝒰</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>eval_modulo</span><span class="main"><span>[</span></span><span class="keyword2"><span class="keyword"><span class="operator"><span>where</span></span></span></span><span> X</span><span class="main"><span class="main"><span>=</span></span></span><span class="quoted"><span class="quoted"><span>"</span><span>frees</span><span> </span><span class="free"><span>t</span></span><span>"</span></span></span><span class="main"><span>,</span></span><span> </span><span class="operator"><span>OF</span></span><span> </span><span>wf</span><span class="main"><span>,</span></span><span> </span><span class="operator"><span>simplified</span></span><span class="main"><span>]</span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Quotients.html#Quotients.fun_quotient_in|fact"><span>fun_quotient_in</span></a><span> </span><a class="entity_ref" href="Quotients.html#Quotients.qequal_fun_def|fact"><span>qequal_fun_def</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Valuation.algloc.eval_closed|fact"><span class="entity_def" id="Valuation.algloc.eval_closed|thm"><span>eval_closed</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>wf</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>wf</span><span> </span><span class="free"><span>t</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>cl</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>closed</span><span> </span><span class="free"><span>t</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>eval</span><span> </span><span class="free"><span>t</span></span><span> </span><span class="free"><span>τ</span></span><span> </span><span class="main"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>=</span></a></span><span> </span><span>eval</span><span> </span><span class="free"><span>t</span></span><span> </span><span class="free"><span>υ</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>(mod</span></a></span><span> </span><span class="keyword1"><span>𝒰</span></span><span class="main"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>)</span></a></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span>frees</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>frees</span><span> </span><span class="free"><span>t</span></span><span> </span><span class="main"><span>⊆</span></span><span> </span><span class="main"><span>{}</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>cl</span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span>closed_def</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>eval_modulo</span><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><span>wf</span><span> </span><span>frees</span><span class="main"><span class="main"><span>,</span></span></span><span> </span><span class="operator"><span>simplified</span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹</span><span>Semantical Equivalence</span><span>›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹</span><span>Two terms are semantically equivalent if for all abstraction algebras, and all valuations, 
</span><span>they evaluate to the same value. We cannot really define this as a closed notion in HOL, 
</span><span>as quantifying over all abstraction algebras requires quantifying over type variables, which is not 
</span><span>possible in HOL. So we first define semantical equivalence just relative to a fixed abstraction algebra,
</span><span>and then relative to the base type of the abstraction algebra.</span><span>›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Valuation.algloc.sem_equiv_def|fact"><span class="entity_def" id="Valuation.algloc.sem_equiv_def|thm"><span class="entity_def" id="Valuation.algloc.sem_equiv_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Valuation.algloc.sem_equiv.cong|fact"><span class="entity_def" id="Valuation.algloc.sem_equiv.cong|thm"><span class="entity_def" id="Valuation.algloc.sem_equiv|const"><span>sem_equiv</span></span></span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="NTerm.html#NTerm.nterm|type"><span>nterm</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="NTerm.html#NTerm.nterm|type"><span>nterm</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span>bool</span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>sem_equiv</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>t</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>∀</span></span><span> </span><span class="bound"><span>υ</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>υ</span></span><span> </span><span class="main"><a class="entity_ref" href="Quotients.html#Quotients.qin|const"><span>/∈</span></a></span><span> </span><span class="main"><span>𝕍</span></span><span> </span><span>UNIV</span><span> </span><span class="main"><span>⟶</span></span><span> </span><span>eval</span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span> </span><span class="bound"><span>υ</span></span><span> </span><span class="main"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>=</span></a></span><span> </span><span>eval</span><span> </span><span class="free"><span class="bound"><span class="entity"><span>t</span></span></span></span><span> </span><span class="bound"><span>υ</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>(mod</span></a></span><span> </span><span class="keyword1"><span>𝒰</span></span><span class="main"><a class="entity_ref" href="Quotients.html#Quotients.qequals|const"><span>)</span></a></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>


</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹</span><span>HOL can be extended with quantification over type variables~</span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>cite</span></span><span> "</span><span>Melham-typequantification</span><span>"</span><span class="antiquote"><span>}</span></span></span><span>,
</span><span>and then the notion of semantical equivalence of two terms could be defined via 
</span><span>
</span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>text</span></span><span> </span><span class="raw_text"><span>‹semantically_equivalent s t = ∀α. ∀ 𝔄 :: α algebra. algloc.sem_equiv 𝔄 s t›</span></span><span class="antiquote"><span>}</span></span></span><span> 
</span><span>
</span><span>But all we can do here is to define semantical equivalence relative to </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>text</span></span><span> </span><span class="raw_text"><span>‹α›</span></span><span class="antiquote"><span>}</span></span></span><span>:</span><span>
</span><span>›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Valuation.semantically_equivalent_def|fact"><span class="entity_def" id="Valuation.semantically_equivalent_def|thm"><span class="entity_def" id="Valuation.semantically_equivalent_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Valuation.semantically_equivalent|const"><span>semantically_equivalent</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="NTerm.html#NTerm.nterm|type"><span>nterm</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="NTerm.html#NTerm.nterm|type"><span>nterm</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span>bool</span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>semantically_equivalent</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>α</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>t</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>∀</span></span><span> </span><span class="bound"><span>𝔄</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><a class="entity_ref" href="Algebra.html#Algebra.algebra|type"><span>algebra</span></a><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Valuation.html#Valuation.algloc.sem_equiv|const"><span>algloc.sem_equiv</span></a><span> </span><span class="bound"><span>𝔄</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>t</span></span></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Valuation.html#Valuation.semantically_equivalent|const"><span>semantically_equivalent</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>α<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main"><span>::</span></span><span class="tfree"><span>'a</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>s</span></span><span> </span><span class="free"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Valuation.html#Valuation.semantically_equivalent|const"><span>semantically_equivalent</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>α<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main"><span>::</span></span><span class="tfree"><span>'a</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>s</span></span><span> </span><span class="free"><span>t</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Valuation.html#Valuation.semantically_equivalent_def|fact"><span>semantically_equivalent_def</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span></pre>
</body>

</html>