<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory General</title>
</head>


<body>
<div class="head">
<h1>Theory General</h1>
</div>

<pre class="source"><span class="keyword1"><span class="command"><span>theory</span></span></span><span> </span><span>General</span><span> 
  </span><span class="keyword2"><span class="keyword"><span>imports</span></span></span><span> </span><a href="../../HOL/HOL/Main.html"><span>Main</span></a><span> </span><span class="quoted"><span>"</span><a href="../../HOL/HOL-Library/LaTeXsugar.html"><span>HOL-Library.LaTeXsugar</span></a><span>"</span></span><span> </span><span class="quoted"><span>"</span><a href="../../HOL/HOL-Library/OptionalSugar.html"><span>HOL-Library.OptionalSugar</span></a><span>"</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>begin</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>section</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹</span><span>General</span><span>›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹</span><span>nats</span><span>›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="General.nats_def|fact"><span class="entity_def" id="General.nats_def|thm"><span class="entity_def" id="General.nats_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="General.nats|const"><span>nats</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>nat</span><span> </span><span class="main"><span>⇒</span></span><span> </span><span>nat</span><span> </span><span>set</span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>nats</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{..&lt;</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span> </span><span class="main"><span>}</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.finite_nats|fact"><span class="entity_def" id="General.finite_nats|thm"><span>finite_nats</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>iff</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>finite</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="General.html#General.nats|const"><span>nats</span></a><span> </span><span class="free"><span>n</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="General.html#General.nats_def|fact"><span>nats_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.nats_elem|fact"><span class="entity_def" id="General.nats_elem|thm"><span>nats_elem</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>d</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><a class="entity_ref" href="General.html#General.nats|const"><span>nats</span></a><span> </span><span class="free"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>d</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span>n</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="General.html#General.nats_def|fact"><span>nats_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.nats_0|fact"><span class="entity_def" id="General.nats_0|thm"><span>nats_0</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="General.html#General.nats|const"><span>nats</span></a><span> </span><span class="main"><span>0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{}</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="General.html#General.nats_def|fact"><span>nats_def</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.card_nats|fact"><span class="entity_def" id="General.card_nats|thm"><span>card_nats</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>card</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="General.html#General.nats|const"><span>nats</span></a><span> </span><span class="free"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="General.html#General.nats_def|fact"><span>nats_def</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.nats_eq_nats|fact"><span class="entity_def" id="General.nats_eq_nats|thm"><span>nats_eq_nats</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="General.html#General.nats|const"><span>nats</span></a><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="General.html#General.nats|const"><span>nats</span></a><span> </span><span class="free"><span>m</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>m</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="General.html#General.card_nats|fact"><span>card_nats</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.Max_nats|fact"><span class="entity_def" id="General.Max_nats|thm"><span>Max_nats</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>n</span></span><span> </span><span class="main"><span>&gt;</span></span><span> </span><span class="main"><span>0</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>1</span></span><span> </span><span class="main"><span>+</span></span><span> </span><span>Max</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="General.html#General.nats|const"><span>nats</span></a><span> </span><span class="free"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><span>Max_gr_iff</span><span> </span><span>Max_in</span><span> </span><span>Suc_eq_plus1_left</span><span> </span><span>Suc_leI</span><span> </span><a class="entity_ref" href="General.html#General.finite_nats|fact"><span>finite_nats</span></a><span> </span><span>lessI</span><span> 
      </span><span>linorder_neqE_nat</span><span> </span><a class="entity_ref" href="General.html#General.nats_0|fact"><span>nats_0</span></a><span> </span><a class="entity_ref" href="General.html#General.nats_elem|fact"><span>nats_elem</span></a><span> </span><span>not_le</span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹</span><span>Lists</span><span>›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>subsubsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹</span><span>Tools for Indices</span><span>›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.nats_length_nths|fact"><span class="entity_def" id="General.nats_length_nths|thm"><span>nats_length_nths</span></span></span><span class="main"><span>:</span></span><span> 
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>A</span></span><span> </span><span class="main"><span>⊆</span></span><span> </span><a class="entity_ref" href="General.html#General.nats|const"><span>nats</span></a><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> 
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>length</span><span> </span><span class="main"><span>(</span></span><span>nths</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="free"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>card</span><span> </span><span class="free"><span>A</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span> 
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span>l1</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>length</span><span> </span><span class="main"><span>(</span></span><span>nths</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="free"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>card</span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span>length</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>∧</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="free"><span>A</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>length_nths</span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>force</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span>l2</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>card</span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span>length</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>∧</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="free"><span>A</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>card</span><span> </span><span class="free"><span>A</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>smt</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> ccfv_SIG</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><span>Collect_cong</span><span> </span><span>Collect_mem_eq</span><span> </span><span>Orderings.order_eq_iff</span><span> 
        </span><span>assms</span><span> </span><span>le_fun_def</span><span> </span><span>less_eq_set_def</span><span> </span><a class="entity_ref" href="General.html#General.nats_elem|fact"><span>nats_elem</span></a><span> </span><span>subsetI</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><span>l1</span><span> </span><span>l2</span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>presburger</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>  

</span><span class="keyword1"><span class="command"><span class="entity_def" id="General.index_of.elims|fact"><span class="entity_def" id="General.index_of.induct|fact"><span class="entity_def" id="General.index_of.simps|fact"><span class="entity_def" id="General.index_of.pelims|fact"><span class="entity_def" id="General.index_of.cases|fact"><span class="entity_def" id="General.index_of.termination|fact"><span class="entity_def" id="General.index_of.pinduct|fact"><span class="entity_def" id="General.index_of.psimps|fact"><span class="entity_def" id="General.index_of_rel.inducts|fact"><span class="entity_def" id="General.index_of_rel.simps|fact"><span class="entity_def" id="General.index_of_rel.induct|fact"><span class="entity_def" id="General.index_of_rel.cases|fact"><span class="entity_def" id="General.index_of_rel.intros|fact"><span class="entity_def" id="General.index_of_graph.inducts|fact"><span class="entity_def" id="General.index_of_graph.simps|fact"><span class="entity_def" id="General.index_of_graph.induct|fact"><span class="entity_def" id="General.index_of_graph.cases|fact"><span class="entity_def" id="General.index_of_graph.intros|fact"><span class="entity_def" id="General.index_of.elims|thm"><span class="entity_def" id="General.index_of.induct|thm"><span class="entity_def" id="General.index_of.simps(2)|thm"><span class="entity_def" id="General.index_of.simps(1)|thm"><span class="entity_def" id="General.index_of.pelims|thm"><span class="entity_def" id="General.index_of.cases|thm"><span class="entity_def" id="General.index_of.termination|thm"><span class="entity_def" id="General.index_of.pinduct|thm"><span class="entity_def" id="General.index_of.psimps(2)|thm"><span class="entity_def" id="General.index_of.psimps(1)|thm"><span class="entity_def" id="General.index_of_rel.inducts|thm"><span class="entity_def" id="General.index_of_rel.simps|thm"><span class="entity_def" id="General.index_of_rel.induct|thm"><span class="entity_def" id="General.index_of_rel.cases|thm"><span class="entity_def" id="General.index_of_rel.intros|thm"><span class="entity_def" id="General.index_of_graph.inducts|thm"><span class="entity_def" id="General.index_of_graph.simps|thm"><span class="entity_def" id="General.index_of_graph.induct|thm"><span class="entity_def" id="General.index_of_graph.cases|thm"><span class="entity_def" id="General.index_of_graph.intros(2)|thm"><span class="entity_def" id="General.index_of_graph.intros(1)|thm"><span class="entity_def" id="General.index_of_def|axiom"><span class="entity_def" id="General.index_of_rel_def|axiom"><span class="entity_def" id="General.index_of_sumC_def|axiom"><span class="entity_def" id="General.index_of_graph_def|axiom"><span class="entity_def" id="General.index_of_dom|const"><span class="entity_def" id="General.index_of_rel|const"><span class="entity_def" id="General.index_of_sumC|const"><span class="entity_def" id="General.index_of_graph|const"><span>fun</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="General.index_of|const"><span>index_of</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><span>list</span><span> </span><span class="main"><span>⇒</span></span><span> </span><span>nat</span><span> </span><span>option</span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>index_of</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="main"><span>[]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>None</span><span>"</span></span></span><span>
</span><span class="main"><span>|</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>index_of</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span class="main"><span>#</span></span><span class="free"><span class="bound"><span class="entity"><span>as</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span>if</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span> </span><span class="keyword1"><span>then</span></span><span> </span><span>Some</span><span> </span><span class="main"><span>0</span></span><span> </span><span class="keyword1"><span>else</span></span><span> 
     </span><span class="main"><span>(</span></span><span class="keyword1"><span>case</span></span><span> </span><span class="free"><span>index_of</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>as</span></span></span></span><span> </span><span class="keyword1"><span>of</span></span><span> 
        None </span><span class="main"><span>⇒</span></span><span> </span><span>None</span><span>
      </span><span class="main"><span>|</span></span><span> Some </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span>Some</span><span> </span><span class="main"><span>(</span></span><span>Suc</span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.index_of_head|fact"><span class="entity_def" id="General.index_of_head|thm"><span>index_of_head</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="General.html#General.index_of|const"><span>index_of</span></a><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>x</span></span><span> </span><span class="main"><span>#</span></span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Some</span><span> </span><span class="main"><span>0</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.index_of_exists|fact"><span class="entity_def" id="General.index_of_exists|thm"><span>index_of_exists</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>x</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span>set</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>∃</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="General.html#General.index_of|const"><span>index_of</span></a><span> </span><span class="free"><span>x</span></span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Some</span><span> </span><span class="bound"><span>i</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>induct</span></span><span> </span><span class="quoted"><span class="free"><span>xs</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>Nil</span><span>
  </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span>Cons</span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="skolem"><span>xs</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>cases</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>a</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>x</span></span><span>"</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>True</span><span>
    </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
  </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>False</span><span>
    </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> 
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>Cons.hyps</span><span> </span><span>Cons.prems</span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>fastforce</span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.index_of_is_None|fact"><span class="entity_def" id="General.index_of_is_None|thm"><span>index_of_is_None</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="General.html#General.index_of|const"><span>index_of</span></a><span> </span><span class="free"><span>x</span></span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>None</span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>∉</span></span><span> </span><span>set</span><span> </span><span class="free"><span>xs</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="General.html#General.index_of_exists|fact"><span>index_of_exists</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>fastforce</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.index_of_is_Some|fact"><span class="entity_def" id="General.index_of_is_Some|thm"><span>index_of_is_Some</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="General.html#General.index_of|const"><span>index_of</span></a><span> </span><span class="free"><span>x</span></span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Some</span><span> </span><span class="free"><span>i</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span>length</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>∧</span></span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>!</span></span><span class="free"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>x</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>induct</span></span><span> </span><span class="quoted"><span class="free"><span>xs</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>i</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>Nil</span><span>
  </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span>Cons</span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="skolem"><span>as</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> 
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>cases</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>a</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>x</span></span><span>"</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>True</span><span>
    </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>0</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>Cons</span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
    </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>Cons</span><span> </span><span>True</span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>False</span><span>
    </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span>rec</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="General.html#General.index_of|const"><span>index_of</span></a><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>a</span></span><span class="main"><span>#</span></span><span class="skolem"><span>as</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span>case</span></span><span> </span><a class="entity_ref" href="General.html#General.index_of|const"><span>index_of</span></a><span> </span><span class="free"><span>x</span></span><span> </span><span class="skolem"><span>as</span></span><span> </span><span class="keyword1"><span>of</span></span><span>
                 None </span><span class="main"><span>⇒</span></span><span> </span><span>None</span><span> 
               </span><span class="main"><span>|</span></span><span> Some </span><span class="bound"><span>k</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span>Some</span><span> </span><span class="main"><span>(</span></span><span>Suc</span><span> </span><span class="bound"><span>k</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
    </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>∃</span></span><span> </span><span class="bound"><span>k</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="General.html#General.index_of|const"><span>index_of</span></a><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>a</span></span><span class="main"><span>#</span></span><span class="skolem"><span>as</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Some</span><span> </span><span class="main"><span>(</span></span><span>Suc</span><span> </span><span class="bound"><span>k</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>∧</span></span><span> </span><a class="entity_ref" href="General.html#General.index_of|const"><span>index_of</span></a><span> </span><span class="free"><span>x</span></span><span> </span><span class="skolem"><span>as</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Some</span><span> </span><span class="bound"><span>k</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><span>Cons.prems</span><span> </span><span>not_None_eq</span><span> </span><span>option.simps</span><span class="main"><span class="main"><span>(</span></span></span><span>4</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><span>option.simps</span><span class="main"><span class="main"><span>(</span></span></span><span>5</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>k</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span>k</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span> </span><a class="entity_ref" href="General.html#General.index_of|const"><span>index_of</span></a><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>a</span></span><span class="main"><span>#</span></span><span class="skolem"><span>as</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Some</span><span> </span><span class="main"><span>(</span></span><span>Suc</span><span> </span><span class="skolem"><span>k</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>∧</span></span><span> </span><a class="entity_ref" href="General.html#General.index_of|const"><span>index_of</span></a><span> </span><span class="free"><span>x</span></span><span> </span><span class="skolem"><span>as</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Some</span><span> </span><span class="skolem"><span>k</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
    </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>Cons</span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>force</span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="General.shift_index_def|fact"><span class="entity_def" id="General.shift_index_def|thm"><span class="entity_def" id="General.shift_index_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="General.shift_index|const"><span>shift_index</span></span></span><span>  </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>nat</span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>(</span></span><span>nat</span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>nat</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="tfree"><span>'a</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> 
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>shift_index</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>d</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="main"><span>+</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>d</span></span></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>  

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.shift_index_0|fact"><span class="entity_def" id="General.shift_index_0|thm"><span>shift_index_0</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="General.html#General.shift_index|const"><span>shift_index</span></a><span> </span><span class="main"><span>0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>id</span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>subst</span></span><span> </span><span>fun_eq_iff</span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>auto</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="General.html#General.shift_index_def|fact"><span>shift_index_def</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.shift_index_acc_append|fact"><span class="entity_def" id="General.shift_index_acc_append|thm"><span>shift_index_acc_append</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> 
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="General.html#General.shift_index|const"><span>shift_index</span></a><span> </span><span class="free"><span>d</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>acc</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>acc</span></span><span> </span><span class="main"><span>@</span></span><span> </span><span class="main"><span>[</span></span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>acc</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>acc</span></span><span> </span><span class="main"><span>@</span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="General.html#General.shift_index|const"><span>shift_index</span></a><span> </span><span class="free"><span>d</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="General.html#General.shift_index_def|fact"><span>shift_index_def</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.shift_index_gather|fact"><span class="entity_def" id="General.shift_index_gather|thm"><span>shift_index_gather</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="General.html#General.shift_index|const"><span>shift_index</span></a><span> </span><span class="free"><span>d</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>acc</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>g</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>acc</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>acc</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>g</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="General.html#General.shift_index|const"><span>shift_index</span></a><span> </span><span class="free"><span>d</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>acc</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="General.html#General.shift_index_def|fact"><span>shift_index_def</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.shift_index_applied_twice|fact"><span class="entity_def" id="General.shift_index_applied_twice|thm"><span>shift_index_applied_twice</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="General.html#General.shift_index|const"><span>shift_index</span></a><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="General.html#General.shift_index|const"><span>shift_index</span></a><span> </span><span class="free"><span>b</span></span><span> </span><span class="free"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="General.html#General.shift_index|const"><span>shift_index</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>a</span></span><span class="main"><span>+</span></span><span class="free"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>f</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>subst</span></span><span> </span><span>fun_eq_iff</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="General.html#General.shift_index_def|fact"><span>shift_index_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><span>ab_semigroup_add_class.add_ac</span><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.shift_index_unindexed|fact"><span class="entity_def" id="General.shift_index_unindexed|thm"><span>shift_index_unindexed</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="General.html#General.shift_index|const"><span>shift_index</span></a><span> </span><span class="free"><span>d</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>F</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>F</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="General.html#General.shift_index_def|fact"><span>shift_index_def</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="General.sorted_list_def|fact"><span class="entity_def" id="General.sorted_list_def|thm"><span class="entity_def" id="General.sorted_list_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="General.sorted_list|const"><span>sorted_list</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>nat</span><span> </span><span>set</span><span> </span><span class="main"><span>⇒</span></span><span> </span><span>nat</span><span> </span><span>list</span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>sorted_list</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>js</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span>THE</span></span><span> </span><span class="bound"><span>l</span></span><span class="main"><span>.</span></span><span> </span><span>sorted</span><span> </span><span class="bound"><span>l</span></span><span> </span><span class="main"><span>∧</span></span><span> </span><span>distinct</span><span> </span><span class="bound"><span>l</span></span><span> </span><span class="main"><span>∧</span></span><span> </span><span>set</span><span> </span><span class="bound"><span>l</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>js</span></span></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.set_sorted_list|fact"><span class="entity_def" id="General.set_sorted_list|thm"><span>set_sorted_list</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>finite</span><span> </span><span class="free"><span>js</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span>set</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="General.html#General.sorted_list|const"><span>sorted_list</span></a><span> </span><span class="free"><span>js</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>js</span></span><span>"</span></span></span><span> 
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="General.html#General.sorted_list_def|fact"><span>sorted_list_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>finite_sorted_distinct_unique</span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>smt</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> del_insts</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><span>the_equality</span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.sorted_sorted_list|fact"><span class="entity_def" id="General.sorted_sorted_list|thm"><span>sorted_sorted_list</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>finite</span><span> </span><span class="free"><span>js</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span>sorted</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="General.html#General.sorted_list|const"><span>sorted_list</span></a><span> </span><span class="free"><span>js</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="General.html#General.sorted_list_def|fact"><span>sorted_list_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>finite_sorted_distinct_unique</span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>smt</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> del_insts</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><span>the_equality</span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.distinct_sorted_list|fact"><span class="entity_def" id="General.distinct_sorted_list|thm"><span>distinct_sorted_list</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>finite</span><span> </span><span class="free"><span>js</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span>distinct</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="General.html#General.sorted_list|const"><span>sorted_list</span></a><span> </span><span class="free"><span>js</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="General.html#General.sorted_list_def|fact"><span>sorted_list_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>finite_sorted_distinct_unique</span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>smt</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> del_insts</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><span>the_equality</span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.sorted_list_intro|fact"><span class="entity_def" id="General.sorted_list_intro|thm"><span>sorted_list_intro</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>sorted</span><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><span>∧</span></span><span> </span><span>distinct</span><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><span>∧</span></span><span> </span><span>set</span><span> </span><span class="free"><span>l</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>js</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="General.html#General.sorted_list|const"><span>sorted_list</span></a><span> </span><span class="free"><span>js</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>l</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>meson</span></span><span> </span><span>List.finite_set</span><span> </span><a class="entity_ref" href="General.html#General.distinct_sorted_list|fact"><span>distinct_sorted_list</span></a><span> </span><a class="entity_ref" href="General.html#General.set_sorted_list|fact"><span>set_sorted_list</span></a><span> </span><span>sorted_distinct_set_unique</span><span> 
      </span><a class="entity_ref" href="General.html#General.sorted_sorted_list|fact"><span>sorted_sorted_list</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.sorted_list_nats|fact"><span class="entity_def" id="General.sorted_list_nats|thm"><span>sorted_list_nats</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="General.html#General.sorted_list|const"><span>sorted_list</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="General.html#General.nats|const"><span>nats</span></a><span> </span><span class="free"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>0</span></span><span> </span><span class="main"><span>..&lt;</span></span><span> </span><span class="free"><span>n</span></span><span class="main"><span>]</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>atLeast_upt</span><span> </span><span>distinct_upt</span><span> </span><a class="entity_ref" href="General.html#General.nats_def|fact"><span>nats_def</span></a><span> </span><a class="entity_ref" href="General.html#General.sorted_list_intro|fact"><span>sorted_list_intro</span></a><span> </span><span>sorted_upt</span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>presburger</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.no_index_sorted_list|fact"><span class="entity_def" id="General.no_index_sorted_list|thm"><span>no_index_sorted_list</span></span></span><span class="main"><span>:</span></span><span> 
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>finite</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>finite</span><span> </span><span class="free"><span>js</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>j</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>j</span></span><span> </span><span class="main"><span>∉</span></span><span> </span><span class="free"><span>js</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="General.html#General.index_of|const"><span>index_of</span></a><span> </span><span class="free"><span>j</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="General.html#General.sorted_list|const"><span>sorted_list</span></a><span> </span><span class="free"><span>js</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>None</span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>{</span></span></span><span>
    </span><span class="keyword3"><span class="command"><span>fix</span></span></span><span> </span><span class="skolem"><span>i</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span>nat</span></span><span>
    </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="General.html#General.index_of|const"><span>index_of</span></a><span> </span><span class="free"><span>j</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="General.html#General.sorted_list|const"><span>sorted_list</span></a><span> </span><span class="free"><span>js</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Some</span><span> </span><span class="skolem"><span>i</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>j</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="free"><span>js</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="General.html#General.index_of_is_Some|fact"><span>index_of_is_Some</span></a><span> </span><span>local.finite</span><span> </span><span>nth_mem</span><span> </span><a class="entity_ref" href="General.html#General.set_sorted_list|fact"><span>set_sorted_list</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>}</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>j</span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>fastforce</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.index_sorted_list|fact"><span class="entity_def" id="General.index_sorted_list|thm"><span>index_sorted_list</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>finite</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>finite</span><span> </span><span class="free"><span>js</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>j</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>j</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="free"><span>js</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>∃</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="General.html#General.index_of|const"><span>index_of</span></a><span> </span><span class="free"><span>j</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="General.html#General.sorted_list|const"><span>sorted_list</span></a><span> </span><span class="free"><span>js</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Some</span><span> </span><span class="bound"><span>i</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="General.html#General.index_of_exists|fact"><span>index_of_exists</span></a><span> </span><span>j</span><span> </span><span>local.finite</span><span> </span><a class="entity_ref" href="General.html#General.set_sorted_list|fact"><span>set_sorted_list</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.upper_bound_index_sorted_list|fact"><span class="entity_def" id="General.upper_bound_index_sorted_list|thm"><span>upper_bound_index_sorted_list</span></span></span><span class="main"><span>:</span></span><span> 
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>finite</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>finite</span><span> </span><span class="free"><span>js</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span>j</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>j</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="free"><span>js</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>the</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="General.html#General.index_of|const"><span>index_of</span></a><span> </span><span class="free"><span>j</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="General.html#General.sorted_list|const"><span>sorted_list</span></a><span> </span><span class="free"><span>js</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span>card</span><span> </span><span class="free"><span>js</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>smt</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> best</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="General.html#General.distinct_sorted_list|fact"><span>distinct_sorted_list</span></a><span> </span><a class="entity_ref" href="General.html#General.index_of_is_None|fact"><span>index_of_is_None</span></a><span> </span><a class="entity_ref" href="General.html#General.index_of_is_Some|fact"><span>index_of_is_Some</span></a><span> </span><span>j</span><span> 
      </span><span>local.finite</span><span> </span><span>option.exhaust_sel</span><span> </span><a class="entity_ref" href="General.html#General.set_sorted_list|fact"><span>set_sorted_list</span></a><span> </span><span>sorted_list_of_set.idem_if_sorted_distinct</span><span> 
      </span><span>sorted_list_of_set_unique</span><span> </span><a class="entity_ref" href="General.html#General.sorted_sorted_list|fact"><span>sorted_sorted_list</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>subsubsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹</span><span>Indexed Quantification</span><span>›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="General.list_indexed_forall_def|fact"><span class="entity_def" id="General.list_indexed_forall_def|thm"><span class="entity_def" id="General.list_indexed_forall_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="General.list_indexed_forall|const"><span>list_indexed_forall</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'a</span></span><span> </span><span>list</span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="main"><span>(</span></span><span>nat</span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span>bool</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span>bool</span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>list_indexed_forall</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>xs</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>∀</span></span><span> </span><span class="bound"><span class="bound"><span>i</span></span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span>length</span><span> </span><span class="free"><span class="bound"><span class="entity"><span>xs</span></span></span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>xs</span></span></span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>syntax</span></span></span><span>
  </span><span class="quoted"><span>"</span><span>_list_indexed_forall</span><span>"</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>pttrn</span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><span>list</span><span> </span><span class="main"><span>⇒</span></span><span> </span><span>pttrn</span><span> </span><span class="main"><span>⇒</span></span><span> </span><span>bool</span><span> </span><span class="main"><span>⇒</span></span><span> </span><span>bool</span><span>"</span></span></span><span>  
    </span><span class="main"><span>(</span></span><span class="quoted"><span>"</span><span class="keyword3"><span>(3</span></span><span class="keyword1"><span>∀</span></span><span> </span><span>_</span><span> </span><span class="keyword1"><span>=</span></span><span> </span><span>_</span><span class="keyword1"><span>!</span></span><span>_</span><span class="keyword1"><span>.</span></span><span class="keyword3"><span>/ </span></span><span>_</span><span class="keyword3"><span>)</span></span><span>"</span></span><span> </span><span class="main"><span>[</span></span><span>1000</span><span class="main"><span>,</span></span><span> 100</span><span class="main"><span>,</span></span><span> 1000</span><span class="main"><span>,</span></span><span> 10</span><span class="main"><span>]</span></span><span> 10</span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>translations</span></span></span><span>
  </span><span class="quoted"><span>"</span><span class="main"><span>∀</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>!</span></span><span class="free"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>P</span></span><span>"</span></span><span> </span><span class="main"><span>⇌</span></span><span> </span><span class="quoted"><span>"</span><span class="keyword1"><span>CONST</span></span><span> </span><a class="entity_ref" href="General.html#General.list_indexed_forall|const"><span>list_indexed_forall</span></a><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="free"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>P</span></span><span class="main"><span>)</span></span><span>"</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.list_indexed_forall_cong|fact"><span class="entity_def" id="General.list_indexed_forall_cong|thm"><span>list_indexed_forall_cong</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>fundef_cong</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>ys</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span>length</span><span> </span><span class="free"><span>ys</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>ys</span></span><span class="main"><span>!</span></span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>Q</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>x</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>∀</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>!</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>∀</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>ys</span></span><span class="main"><span>!</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>Q</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span>assms</span><span> </span><a class="entity_ref" href="General.html#General.list_indexed_forall_def|fact"><span>list_indexed_forall_def</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.size_nth|fact"><span class="entity_def" id="General.size_nth|thm"><span>size_nth</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>termination_simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>i</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span>length</span><span> </span><span class="free"><span>ts</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span>size</span><span> </span><span class="main"><span>(</span></span><span class="free"><span>ts</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="free"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span>Suc</span><span> </span><span class="main"><span>(</span></span><span>size_list</span><span> </span><span>size</span><span> </span><span class="free"><span>ts</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>meson</span></span><span> </span><span>Suc_n_not_le_n</span><span> </span><span>linorder_not_less</span><span> </span><span>nth_mem</span><span> </span><span>size_list_estimation'</span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.list_indexed_forall_empty|fact"><span class="entity_def" id="General.list_indexed_forall_empty|thm"><span>list_indexed_forall_empty</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="General.html#General.list_indexed_forall|const"><span>list_indexed_forall</span></a><span> </span><span class="main"><span>[]</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>True</span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="General.html#General.list_indexed_forall_def|fact"><span>list_indexed_forall_def</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.list_indexed_forall_cons|fact"><span class="entity_def" id="General.list_indexed_forall_cons|thm"><span>list_indexed_forall_cons</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> 
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="General.html#General.list_indexed_forall|const"><span>list_indexed_forall</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>x</span></span><span class="main"><span>#</span></span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span> </span><span class="main"><span>0</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>∧</span></span><span> </span><a class="entity_ref" href="General.html#General.list_indexed_forall|const"><span>list_indexed_forall</span></a><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="General.html#General.shift_index|const"><span>shift_index</span></a><span> </span><span class="main"><span>1</span></span><span> </span><span class="free"><span>f</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>less_Suc_eq_0_disj</span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="General.html#General.list_indexed_forall_def|fact"><span>list_indexed_forall_def</span></a><span> </span><a class="entity_ref" href="General.html#General.shift_index_def|fact"><span>shift_index_def</span></a><span class="main"><span>)</span></span><span>



</span><span class="keyword1"><span class="command"><span>subsubsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹</span><span>Indexed Fold</span><span>›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="General.list_indexed_fold_def|fact"><span class="entity_def" id="General.list_indexed_fold_def|thm"><span class="entity_def" id="General.list_indexed_fold_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="General.list_indexed_fold|const"><span>list_indexed_fold</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span>nat</span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><span>list</span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> 
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>list_indexed_fold</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>xs</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>y</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>zip</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>0</span></span><span> </span><span class="main"><span>..&lt;</span></span><span> </span><span>length</span><span> </span><span class="free"><span class="bound"><span class="entity"><span>xs</span></span></span></span><span class="main"><span>]</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>xs</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>y</span></span></span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>syntax</span></span></span><span>
  </span><span class="quoted"><span>"</span><span>_list_indexed_fold</span><span>"</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>pttrn</span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span>pttrn</span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><span>list</span><span> </span><span class="main"><span>⇒</span></span><span> </span><span>pttrn</span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span>"</span></span></span><span> 
    </span><span class="main"><span>(</span></span><span class="quoted"><span>"</span><span class="keyword3"><span>(3</span></span><span class="keyword1"><span>§fold</span></span><span> </span><span>_</span><span> </span><span class="keyword1"><span>=</span></span><span class="keyword3"><span>/ </span></span><span>_</span><span class="keyword1"><span>,</span></span><span class="keyword3"><span>/ </span></span><span>_</span><span> </span><span class="keyword1"><span>=</span></span><span class="keyword3"><span>/ </span></span><span>_</span><span class="keyword1"><span>!</span></span><span>_</span><span class="keyword1"><span>.</span></span><span class="keyword3"><span>/ </span></span><span>_</span><span class="keyword3"><span>)</span></span><span>"</span></span><span>  </span><span class="main"><span>[</span></span><span>1000</span><span class="main"><span>,</span></span><span> 51</span><span class="main"><span>,</span></span><span> 1000</span><span class="main"><span>,</span></span><span> 100</span><span class="main"><span>,</span></span><span> 1000</span><span class="main"><span>,</span></span><span> 10</span><span class="main"><span>]</span></span><span> 10</span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>translations</span></span></span><span>
   </span><span class="quoted"><span>"</span><span class="keyword1"><span>§fold</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>a0</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>!</span></span><span class="free"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>F</span></span><span>"</span></span><span> </span><span class="main"><span>⇌</span></span><span> </span><span class="quoted"><span>"</span><span class="keyword1"><span>CONST</span></span><span> </span><a class="entity_ref" href="General.html#General.list_indexed_fold|const"><span>list_indexed_fold</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="free"><span>a</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>F</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="free"><span>a0</span></span><span>"</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.list_indexed_fold_empty|fact"><span class="entity_def" id="General.list_indexed_fold_empty|thm"><span>list_indexed_fold_empty</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="General.html#General.list_indexed_fold|const"><span>list_indexed_fold</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="main"><span>[]</span></span><span> </span><span class="free"><span>y</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>y</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="General.html#General.list_indexed_fold_def|fact"><span>list_indexed_fold_def</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.list_indexed_fold_cong|fact"><span class="entity_def" id="General.list_indexed_fold_cong|thm"><span>list_indexed_fold_cong</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>fundef_cong</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>ys</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span>length</span><span> </span><span class="free"><span>ys</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>ys</span></span><span class="main"><span>!</span></span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>F</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>G</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>x</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="keyword1"><span>§fold</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>a0</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>!</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>F</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span>§fold</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>a0</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>ys</span></span><span class="main"><span>!</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>G</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="General.html#General.list_indexed_fold_def|fact"><span>list_indexed_fold_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>fold_cong</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>assms</span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><span>add.left_neutral</span><span> </span><span>assms</span><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><span>in_set_zip</span><span> </span><span>nth_upt</span><span> </span><span>prod.sel</span><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><span>prod.sel</span><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.list_indexed_fold_eq|fact"><span class="entity_def" id="General.list_indexed_fold_eq|thm"><span>list_indexed_fold_eq</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span>length</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>F</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>xs</span></span><span class="main"><span>!</span></span><span class="bound"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>G</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>xs</span></span><span class="main"><span>!</span></span><span class="bound"><span>i</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="keyword1"><span>§fold</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>a0</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>!</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>F</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span>§fold</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>a0</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>!</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>G</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><span>assms</span><span> </span><a class="entity_ref" href="General.html#General.list_indexed_fold_cong|fact"><span>list_indexed_fold_cong</span></a><span class="main"><span>)</span></span><span> 

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.list_unindexed_forall|fact"><span class="entity_def" id="General.list_unindexed_forall|thm"><span>list_unindexed_forall</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>∀</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>!</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>∀</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span>set</span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="General.html#General.list_indexed_forall_def|fact"><span>list_indexed_forall_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><span>in_set_conv_nth</span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.fold_zip_interval_shift|fact"><span class="entity_def" id="General.fold_zip_interval_shift|thm"><span>fold_zip_interval_shift</span></span></span><span class="main"><span>:</span></span><span> 
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>i</span></span><span> </span><span class="main"><span>+</span></span><span> </span><span>length</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>j</span></span><span> </span><span class="main"><span>⟹</span></span><span> 
     </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>F</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>+</span></span><span> </span><span class="free"><span>d</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>zip</span><span> </span><span class="main"><span>[</span></span><span class="free"><span>i</span></span><span> </span><span class="main"><span>..&lt;</span></span><span> </span><span class="free"><span>j</span></span><span class="main"><span>]</span></span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><span>=</span></span><span> 
     </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>F</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>zip</span><span> </span><span class="main"><span>[</span></span><span class="free"><span>i</span></span><span class="main"><span>+</span></span><span class="free"><span>d</span></span><span> </span><span class="main"><span>..&lt;</span></span><span> </span><span class="free"><span>j</span></span><span class="main"><span>+</span></span><span class="free"><span>d</span></span><span class="main"><span>]</span></span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>a</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>induct</span></span><span> </span><span class="quoted"><span class="free"><span>xs</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>i</span></span></span><span> </span><span class="quoted"><span class="free"><span>j</span></span></span><span> </span><span class="quoted"><span class="free"><span>a</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>Nil</span><span>
  </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span>Cons</span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="skolem"><span>xs</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span>ij</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>i</span></span><span> </span><span class="main"><span>+</span></span><span> </span><span>length</span><span> </span><span class="skolem"><span>xs</span></span><span> </span><span class="main"><span>+</span></span><span> </span><span class="main"><span>1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="skolem"><span>j</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>Cons</span><span class="main"><span>(</span></span><span>2</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
  </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span>ij_interval</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>[</span></span><span class="skolem"><span>i</span></span><span class="main"><span>..&lt;</span></span><span class="skolem"><span>j</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="skolem"><span>i</span></span><span> </span><span class="main"><span>#</span></span><span> </span><span class="main"><span>[</span></span><span>Suc</span><span> </span><span class="skolem"><span>i</span></span><span> </span><span class="main"><span>..&lt;</span></span><span> </span><span class="skolem"><span>j</span></span><span class="main"><span>]</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span>upt_conv_Cons</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><span>ij</span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span>ijd_interval</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>[</span></span><span class="skolem"><span>i</span></span><span class="main"><span>+</span></span><span class="free"><span>d</span></span><span class="main"><span>..&lt;</span></span><span class="skolem"><span>j</span></span><span class="main"><span>+</span></span><span class="free"><span>d</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>i</span></span><span class="main"><span>+</span></span><span class="free"><span>d</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>#</span></span><span> </span><span class="main"><span>[</span></span><span>Suc</span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>i</span></span><span class="main"><span>+</span></span><span class="free"><span>d</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>..&lt;</span></span><span> </span><span class="skolem"><span>j</span></span><span class="main"><span>+</span></span><span class="free"><span>d</span></span><span class="main"><span>]</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span>upt_conv_Cons</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>Cons</span><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span> </span><span>ij</span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span>ij_interval</span><span> </span><span>ijd_interval</span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.fold_zip_interval_shift1|fact"><span class="entity_def" id="General.fold_zip_interval_shift1|thm"><span>fold_zip_interval_shift1</span></span></span><span class="main"><span>:</span></span><span> 
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>i</span></span><span> </span><span class="main"><span>+</span></span><span> </span><span>length</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>j</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>F</span></span><span> </span><span class="main"><span>(</span></span><span>Suc</span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>zip</span><span> </span><span class="main"><span>[</span></span><span class="free"><span>i</span></span><span> </span><span class="main"><span>..&lt;</span></span><span> </span><span class="free"><span>j</span></span><span class="main"><span>]</span></span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><span>=</span></span><span> 
           </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>F</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>zip</span><span> </span><span class="main"><span>[</span></span><span>Suc</span><span> </span><span class="free"><span>i</span></span><span> </span><span class="main"><span>..&lt;</span></span><span> </span><span>Suc</span><span> </span><span class="free"><span>j</span></span><span class="main"><span>]</span></span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>a</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span>add</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span>Suc</span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>+</span></span><span> </span><span class="main"><span>1</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="operator"><span>subst</span></span><span> </span><span>add</span><span class="main"><span>)</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="General.html#General.fold_zip_interval_shift|fact"><span>fold_zip_interval_shift</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span>assms</span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.list_indexed_fold_cons|fact"><span class="entity_def" id="General.list_indexed_fold_cons|thm"><span>list_indexed_fold_cons</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="keyword1"><span>§fold</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>a0</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>u</span></span><span class="main"><span>#</span></span><span class="free"><span>us</span></span><span class="main"><span>)</span></span><span class="main"><span>!</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>F</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span>§fold</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>F</span></span><span> </span><span class="main"><span>0</span></span><span> </span><span class="free"><span>a0</span></span><span> </span><span class="free"><span>u</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>us</span></span><span class="main"><span>!</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="General.html#General.shift_index|const"><span>shift_index</span></a><span> </span><span class="main"><span>1</span></span><span> </span><span class="free"><span>F</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>induct</span></span><span> </span><span class="quoted"><span class="free"><span>us</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>a0</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>Nil</span><span>
  </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> 
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="General.html#General.list_indexed_fold_def|fact"><span>list_indexed_fold_def</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span>Cons</span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="skolem"><span>us</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span>interval</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span> </span><span class="bound"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="bound"><span>n</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>@</span></span><span> </span><span class="main"><span>[</span></span><span class="bound"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span>Suc</span><span> </span><span class="bound"><span>n</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>0</span></span><span> </span><span class="main"><span>#</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span>Suc</span><span> </span><span class="main"><span>0</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>..&lt;</span></span><span> </span><span>Suc</span><span> </span><span class="main"><span>(</span></span><span>Suc</span><span> </span><span class="bound"><span>n</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span>upt_conv_Cons</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span>app1</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>≤</span></span><span> </span><span class="bound"><span>n</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>[</span></span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>..&lt;</span></span><span class="bound"><span>n</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>@</span></span><span> </span><span class="main"><span>[</span></span><span class="bound"><span>n</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>..&lt;</span></span><span> </span><span>Suc</span><span> </span><span class="bound"><span>n</span></span><span class="main"><span>]</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span>app2</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>≤</span></span><span> </span><span class="bound"><span>n</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>[</span></span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>..&lt;</span></span><span class="bound"><span>n</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>@</span></span><span> </span><span class="main"><span>[</span></span><span class="bound"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span>Suc</span><span> </span><span class="bound"><span>n</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>..&lt;</span></span><span> </span><span>Suc</span><span> </span><span class="main"><span>(</span></span><span>Suc</span><span> </span><span class="bound"><span>n</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>"</span></span></span><span> 
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span>empty</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span> </span><span class="bound"><span>us</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>¬</span></span><span> </span><span>Suc</span><span> </span><span class="main"><span>0</span></span><span> </span><span class="main"><span>≤</span></span><span> </span><span>length</span><span> </span><span class="bound"><span>us</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="bound"><span>us</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[]</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>meson</span></span><span> </span><span>Suc_leI</span><span> </span><span>length_greater_0_conv</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><span>Cons</span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="General.html#General.list_indexed_fold_def|fact"><span>list_indexed_fold_def</span></a><span> </span><span>interval</span><span> </span><a class="entity_ref" href="General.html#General.shift_index_def|fact"><span>shift_index_def</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>only</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span>app1</span><span> </span><span>app2</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>subst</span></span><span> </span><a class="entity_ref" href="General.html#General.fold_zip_interval_shift1|fact"><span>fold_zip_interval_shift1</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span>empty</span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.list_unindexed_fold|fact"><span class="entity_def" id="General.list_unindexed_fold|thm"><span>list_unindexed_fold</span></span></span><span class="main"><span>:</span></span><span> 
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="keyword1"><span>§fold</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>a0</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>!</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>F</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="free"><span>F</span></span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="free"><span>a0</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>induct</span></span><span> </span><span class="quoted"><span class="free"><span>xs</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>a0</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>Nil</span><span>
  </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span>Cons</span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="skolem"><span>xs</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> 
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="General.html#General.list_indexed_fold_def|fact"><span>list_indexed_fold_def</span></a><span> </span><a class="entity_ref" href="General.html#General.shift_index_def|fact"><span>shift_index_def</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="General.html#General.list_indexed_fold_def|fact"><span>list_indexed_fold_def</span></a><span> </span><span>local.Cons</span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="comment1"><span>(</span><span>*</span><span>lemma list_indexed_fold_collect: 
  "(§fold X = X0, x = xs!i. X ∪ F i x) = X0 ∪ ⋃ { F i (xs!i) | i. i &lt; length xs }"  
proof (induct xs arbitrary: X0 F)
  case Nil
  show ?case by simp    
next
  case (Cons a xs)
  show ?case using Cons
    apply simp
    sledgehammer
qed</span><span>*</span><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>subsubsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹</span><span>Indexed Map</span><span>›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="General.list_indexed_map_def|fact"><span class="entity_def" id="General.list_indexed_map_def|thm"><span class="entity_def" id="General.list_indexed_map_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="General.list_indexed_map|const"><span>list_indexed_map</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span>nat</span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><span>list</span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span> </span><span>list</span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>list_indexed_map</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>xs</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span>§fold</span></span><span> </span><span class="bound"><span>acc</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[]</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>xs</span></span></span></span><span class="main"><span>!</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>acc</span></span><span> </span><span class="main"><span>@</span></span><span> </span><span class="main"><span>[</span></span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>syntax</span></span></span><span>
  </span><span class="quoted"><span>"</span><span>_list_indexed_map</span><span>"</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>pttrn</span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><span>list</span><span> </span><span class="main"><span>⇒</span></span><span> </span><span>pttrn</span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span> </span><span>list</span><span>"</span></span></span><span> 
    </span><span class="main"><span>(</span></span><span class="quoted"><span>"</span><span class="keyword3"><span>(3</span></span><span class="keyword1"><span>§map</span></span><span> </span><span>_</span><span> </span><span class="keyword1"><span>=</span></span><span class="keyword3"><span>/ </span></span><span>_</span><span class="keyword1"><span>!</span></span><span>_</span><span class="keyword1"><span>.</span></span><span class="keyword3"><span>/ </span></span><span>_</span><span class="keyword3"><span>)</span></span><span>"</span></span><span> </span><span class="main"><span>[</span></span><span>1000</span><span class="main"><span>,</span></span><span> 100</span><span class="main"><span>,</span></span><span> 1000</span><span class="main"><span>,</span></span><span> 10</span><span class="main"><span>]</span></span><span> 10</span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>translations</span></span></span><span>
   </span><span class="quoted"><span>"</span><span class="keyword1"><span>§map</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>!</span></span><span class="free"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>F</span></span><span>"</span></span><span>  </span><span class="main"><span>⇌</span></span><span> </span><span class="quoted"><span>"</span><span class="keyword1"><span>CONST</span></span><span> </span><a class="entity_ref" href="General.html#General.list_indexed_map|const"><span>list_indexed_map</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="free"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>F</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>xs</span></span><span>"</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.list_indexed_map_cong|fact"><span class="entity_def" id="General.list_indexed_map_cong|thm"><span>list_indexed_map_cong</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>fundef_cong</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>ys</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span>length</span><span> </span><span class="free"><span>ys</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>ys</span></span><span class="main"><span>!</span></span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>F</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>G</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>x</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="keyword1"><span>§map</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>!</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>F</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span>§map</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>ys</span></span><span class="main"><span>!</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>G</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="General.html#General.list_indexed_map_def|fact"><span>list_indexed_map_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="General.html#General.list_indexed_fold_cong|fact"><span>list_indexed_fold_cong</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span>assms</span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>[</span></span><span class="numeral"><span>9</span></span><span class="main"><span>,</span></span><span> </span><span class="numeral"><span>49</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span>§map</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="numeral"><span>3</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span>nat</span><span class="main"><span>,</span></span><span> </span><span class="numeral"><span>7</span></span><span class="main"><span>]</span></span><span class="main"><span>!</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>*</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="General.html#General.list_indexed_map_def|fact"><span>list_indexed_map_def</span></a><span> </span><a class="entity_ref" href="General.html#General.shift_index_def|fact"><span>shift_index_def</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.list_indexed_map_empty|fact"><span class="entity_def" id="General.list_indexed_map_empty|thm"><span>list_indexed_map_empty</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="General.html#General.list_indexed_map|const"><span>list_indexed_map</span></a><span> </span><span class="free"><span>F</span></span><span> </span><span class="main"><span>[]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[]</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="General.html#General.list_indexed_map_def|fact"><span>list_indexed_map_def</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.list_indexed_map_append_gen1|fact"><span class="entity_def" id="General.list_indexed_map_append_gen1|thm"><span>list_indexed_map_append_gen1</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="keyword1"><span>§fold</span></span><span> </span><span class="bound"><span>acc</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>acc0</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>as</span></span><span class="main"><span>@</span></span><span class="free"><span>bs</span></span><span class="main"><span>)</span></span><span class="main"><span>!</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>acc</span></span><span> </span><span class="main"><span>@</span></span><span> </span><span class="main"><span>[</span></span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> 
       </span><span class="main"><span>(</span></span><span class="keyword1"><span>§fold</span></span><span> </span><span class="bound"><span>acc</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span>§fold</span></span><span> </span><span class="bound"><span>acc</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>acc0</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>as</span></span><span class="main"><span>!</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>acc</span></span><span> </span><span class="main"><span>@</span></span><span> </span><span class="main"><span>[</span></span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> 
          </span><span class="free"><span>bs</span></span><span class="main"><span>!</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>acc</span></span><span> </span><span class="main"><span>@</span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="General.html#General.shift_index|const"><span>shift_index</span></a><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="free"><span>as</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>induct</span></span><span> </span><span class="quoted"><span class="free"><span>as</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>acc0</span></span></span><span> </span><span class="quoted"><span class="free"><span>bs</span></span></span><span> </span><span class="quoted"><span class="free"><span>f</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>Nil</span><span>
  </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span>Cons</span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="skolem"><span>as</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>subst</span></span><span> </span><span>Cons</span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>    
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.list_indexed_map_append_gen2|fact"><span class="entity_def" id="General.list_indexed_map_append_gen2|thm"><span>list_indexed_map_append_gen2</span></span></span><span class="main"><span>:</span></span><span> 
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="keyword1"><span>§fold</span></span><span> </span><span class="bound"><span>acc</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>as</span></span><span class="main"><span>@</span></span><span class="free"><span>bs</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>!</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>acc</span></span><span> </span><span class="main"><span>@</span></span><span> </span><span class="main"><span>[</span></span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> 
      </span><span class="free"><span>as</span></span><span> </span><span class="main"><span>@</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span>§fold</span></span><span> </span><span class="bound"><span>acc</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>bs</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>!</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>acc</span></span><span> </span><span class="main"><span>@</span></span><span> </span><span class="main"><span>[</span></span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>induct</span></span><span> </span><span class="quoted"><span class="free"><span>xs</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>bs</span></span></span><span> </span><span class="quoted"><span class="free"><span>f</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>Nil</span><span>
  </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span>Cons</span><span> </span><span class="skolem"><span>c</span></span><span> </span><span class="skolem"><span>cs</span></span><span class="main"><span>)</span></span><span> 
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>Cons</span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.list_indexed_map_append|fact"><span class="entity_def" id="General.list_indexed_map_append|thm"><span>list_indexed_map_append</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="keyword1"><span>§map</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>as</span></span><span class="main"><span>@</span></span><span class="free"><span>bs</span></span><span class="main"><span>)</span></span><span class="main"><span>!</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>F</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span>§map</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>as</span></span><span class="main"><span>!</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>F</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>@</span></span><span class="main"><span>(</span></span><span class="keyword1"><span>§map</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>bs</span></span><span class="main"><span>!</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="General.html#General.shift_index|const"><span>shift_index</span></a><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="free"><span>as</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>F</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="General.html#General.list_indexed_map_def|fact"><span>list_indexed_map_def</span></a><span> </span><span>append.right_neutral</span><span> </span><a class="entity_ref" href="General.html#General.list_indexed_map_append_gen1|fact"><span>list_indexed_map_append_gen1</span></a><span> 
      </span><a class="entity_ref" href="General.html#General.list_indexed_map_append_gen2|fact"><span>list_indexed_map_append_gen2</span></a><span class="main"><span>)</span></span><span> 

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.list_indexed_map_single|fact"><span class="entity_def" id="General.list_indexed_map_single|thm"><span>list_indexed_map_single</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="General.html#General.list_indexed_map|const"><span>list_indexed_map</span></a><span> </span><span class="free"><span>F</span></span><span> </span><span class="main"><span>[</span></span><span class="free"><span>a</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="free"><span>F</span></span><span> </span><span class="main"><span>0</span></span><span> </span><span class="free"><span>a</span></span><span class="main"><span>]</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="General.html#General.list_indexed_map_def|fact"><span>list_indexed_map_def</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.list_indexed_map_cons|fact"><span class="entity_def" id="General.list_indexed_map_cons|thm"><span>list_indexed_map_cons</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="keyword1"><span>§map</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>a</span></span><span class="main"><span>#</span></span><span class="free"><span>as</span></span><span class="main"><span>)</span></span><span class="main"><span>!</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>F</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>F</span></span><span> </span><span class="main"><span>0</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><span>#</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span>§map</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>as</span></span><span class="main"><span>!</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="General.html#General.shift_index|const"><span>shift_index</span></a><span> </span><span class="main"><span>1</span></span><span> </span><span class="free"><span>F</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="General.html#General.list_indexed_map_append|fact"><span>list_indexed_map_append</span></a><span class="main"><span>[</span></span><span class="keyword2"><span class="keyword"><span class="operator"><span>where</span></span></span></span><span> as</span><span class="main"><span class="main"><span>=</span></span></span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>[</span></span><span class="free"><span>a</span></span><span class="main"><span>]</span></span><span>"</span></span></span><span class="main"><span>,</span></span><span> </span><span class="operator"><span>simplified</span></span><span class="main"><span>]</span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>force</span></span><span>        

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.map_cons|fact"><span class="entity_def" id="General.map_cons|thm"><span>map_cons</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>map</span><span> </span><span class="free"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>a</span></span><span class="main"><span>#</span></span><span class="free"><span>as</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><span>#</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>as</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>force</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.map_snoc|fact"><span class="entity_def" id="General.map_snoc|thm"><span>map_snoc</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>map</span><span> </span><span class="free"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>as</span></span><span class="main"><span>@</span></span><span class="main"><span>[</span></span><span class="free"><span>a</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>as</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>@</span></span><span> </span><span class="main"><span>[</span></span><span class="free"><span>f</span></span><span> </span><span class="free"><span>a</span></span><span class="main"><span>]</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>F</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="free"><span>a</span></span><span> </span><span class="main"><span>#</span></span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span>length</span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>@</span></span><span> </span><span class="main"><span>[</span></span><span class="free"><span>F</span></span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="free"><span>a</span></span><span> </span><span class="main"><span>#</span></span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span>length</span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span>
       </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>F</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="free"><span>a</span></span><span> </span><span class="main"><span>#</span></span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span>Suc</span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.map_eq_intro|fact"><span class="entity_def" id="General.map_eq_intro|thm"><span>map_eq_intro</span></span></span><span class="main"><span>:</span></span><span> 
  </span><span class="quoted"><span class="quoted"><span>"</span><span>length</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="free"><span>ys</span></span><span> </span><span class="main"><span>⟹</span></span><span> 
   </span><span class="main"><span>(</span></span><span class="main"><span>⋀</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span>length</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>xs</span></span><span class="main"><span>!</span></span><span class="bound"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>g</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>ys</span></span><span class="main"><span>!</span></span><span class="bound"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>⟹</span></span><span> 
   </span><span>map</span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="free"><span>g</span></span><span> </span><span class="free"><span>ys</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span>list_eq_iff_nth_eq</span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.list_indexed_map_alt|fact"><span class="entity_def" id="General.list_indexed_map_alt|thm"><span>list_indexed_map_alt</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="keyword1"><span>§map</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>!</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>F</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>F</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>xs</span></span><span class="main"><span>!</span></span><span class="bound"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>0</span></span><span> </span><span class="main"><span>..&lt;</span></span><span> </span><span>length</span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>]</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>induct</span></span><span> </span><span class="quoted"><span class="free"><span>xs</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>F</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>Nil</span><span>
  </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span>Cons</span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="skolem"><span>xs</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span>m1</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="skolem"><span>F</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="skolem"><span>a</span></span><span> </span><span class="main"><span>#</span></span><span> </span><span class="skolem"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span>length</span><span> </span><span class="skolem"><span>xs</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>@</span></span><span> </span><span class="main"><span>[</span></span><span class="skolem"><span>F</span></span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="skolem"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="skolem"><span>a</span></span><span> </span><span class="main"><span>#</span></span><span> </span><span class="skolem"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span>length</span><span> </span><span class="skolem"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="skolem"><span>F</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="skolem"><span>a</span></span><span> </span><span class="main"><span>#</span></span><span> </span><span class="skolem"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span>Suc</span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="skolem"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span>m2</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="skolem"><span>F</span></span><span> </span><span class="main"><span>(</span></span><span>Suc</span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>xs</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span>length</span><span> </span><span class="skolem"><span>xs</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="skolem"><span>F</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="skolem"><span>a</span></span><span class="main"><span>#</span></span><span class="skolem"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span>Suc</span><span> </span><span class="main"><span>0</span></span><span> </span><span class="main"><span>..&lt;</span></span><span> </span><span>Suc</span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="skolem"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="General.html#General.map_eq_intro|fact"><span>map_eq_intro</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>Suc_le_eq</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><span>Suc_le_eq</span><span> </span><span>add_Suc</span><span> </span><span>comm_monoid_add_class.add_0</span><span> </span><span>not_less_eq_eq</span><span> </span><span>not_less_zero</span><span> 
        </span><span>nth_Cons_Suc</span><span> </span><span>nth_upt</span><span> </span><span>upt_Suc_append</span><span> </span><span>zero_less_iff_neq_zero</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span>m3</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>F</span></span><span> </span><span class="main"><span>0</span></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="main"><span>#</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="skolem"><span>F</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="skolem"><span>a</span></span><span> </span><span class="main"><span>#</span></span><span> </span><span class="skolem"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span>Suc</span><span> </span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span>Suc</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="skolem"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> 
        </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="skolem"><span>F</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="skolem"><span>a</span></span><span> </span><span class="main"><span>#</span></span><span> </span><span class="skolem"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span>Suc</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="skolem"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>no_types</span><span class="main"><span class="main"><span>,</span></span></span><span> lifting</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="General.html#General.map_cons|fact"><span>map_cons</span></a><span> </span><span>nth_Cons_0</span><span> </span><span>upt_conv_Cons</span><span> </span><span>zero_less_Suc</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> 
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="General.html#General.list_indexed_map_cons|fact"><span>list_indexed_map_cons</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>subst</span></span><span> </span><span>Cons</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="General.html#General.shift_index_def|fact"><span>shift_index_def</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>subst</span></span><span> </span><span>m1</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>subst</span></span><span> </span><span>m2</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>subst</span></span><span> </span><span>m3</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>    
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.list_unindexed_map|fact"><span class="entity_def" id="General.list_unindexed_map|thm"><span>list_unindexed_map</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="keyword1"><span>§map</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>!</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>F</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="free"><span>F</span></span><span> </span><span class="free"><span>xs</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>induct</span></span><span> </span><span class="quoted"><span class="free"><span>xs</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>Nil</span><span>
  </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> 
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="General.html#General.list_indexed_map_def|fact"><span>list_indexed_map_def</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span>Cons</span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="skolem"><span>xs</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="General.html#General.list_indexed_map_cons|fact"><span>list_indexed_map_cons</span></a><span> </span><span>Cons</span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.list_indexed_map_length|fact"><span class="entity_def" id="General.list_indexed_map_length|thm"><span>list_indexed_map_length</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>length</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span>§map</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>!</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>F</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="free"><span>xs</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="General.html#General.list_indexed_map_alt|fact"><span>list_indexed_map_alt</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.list_indexed_map_at|fact"><span class="entity_def" id="General.list_indexed_map_at|thm"><span>list_indexed_map_at</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>i</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span>length</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span>§map</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>!</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>F</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>F</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>xs</span></span><span class="main"><span>!</span></span><span class="free"><span>i</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="General.html#General.list_indexed_map_alt|fact"><span>list_indexed_map_alt</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>subsubsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹</span><span>Fold over Indexed Map</span><span>›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.fold_indexed_map|fact"><span class="entity_def" id="General.fold_indexed_map|thm"><span>fold_indexed_map</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="keyword1"><span>§fold</span></span><span> </span><span class="bound"><span>acc</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>a</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>!</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>g</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>F</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>acc</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="free"><span>g</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span>§map</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>=</span></span><span class="free"><span>xs</span></span><span class="main"><span>!</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>F</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>a</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>induct</span></span><span> </span><span class="quoted"><span class="free"><span>xs</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>a</span></span></span><span> </span><span class="quoted"><span class="free"><span>F</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>Nil</span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span>Cons</span><span> </span><span class="skolem"><span>u</span></span><span> </span><span class="skolem"><span>us</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>Cons</span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="General.html#General.list_indexed_map_cons|fact"><span>list_indexed_map_cons</span></a><span> </span><a class="entity_ref" href="General.html#General.shift_index_gather|fact"><span>shift_index_gather</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.fold_union|fact"><span class="entity_def" id="General.fold_union|thm"><span>fold_union</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>λ</span></span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>b</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><span>∪</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="free"><span>a0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>a0</span></span><span> </span><span class="main"><span>∪</span></span><span> </span><span class="main"><span>⋃</span></span><span> </span><span class="main"><span>(</span></span><span>set</span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>induct</span></span><span> </span><span class="quoted"><span class="free"><span>xs</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>a0</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>Nil</span><span>
  </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span>Cons</span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="skolem"><span>xs</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.Un_indexed_nats|fact"><span class="entity_def" id="General.Un_indexed_nats|thm"><span>Un_indexed_nats</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>⋃</span></span><span class="bound"><span>i</span></span><span class="main"><span>∈</span></span><span class="main"><span>{</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>::</span></span><span>nat</span><span class="main"><span>}</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>F</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>⋃</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span class="free"><span>F</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>}</span></span><span>"</span></span></span><span> 
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>blast</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.union_indexed_fold|fact"><span class="entity_def" id="General.union_indexed_fold|thm"><span>union_indexed_fold</span></span></span><span class="main"><span>:</span></span><span> 
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="keyword1"><span>§fold</span></span><span> </span><span class="bound"><span>X</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>X0</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>!</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>X</span></span><span> </span><span class="main"><span>∪</span></span><span> </span><span class="free"><span>F</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>X0</span></span><span> </span><span class="main"><span>∪</span></span><span> </span><span class="main"><span>⋃</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span class="free"><span>F</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>xs</span></span><span class="main"><span>!</span></span><span class="bound"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span>length</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>}</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>subst</span></span><span> </span><a class="entity_ref" href="General.html#General.fold_indexed_map|fact"><span>fold_indexed_map</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>subst</span></span><span> </span><a class="entity_ref" href="General.html#General.fold_union|fact"><span>fold_union</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>subst</span></span><span> </span><a class="entity_ref" href="General.html#General.list_indexed_map_alt|fact"><span>list_indexed_map_alt</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="General.html#General.Un_indexed_nats|fact"><span>Un_indexed_nats</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="General.union_unindexed_fold|fact"><span class="entity_def" id="General.union_unindexed_fold|thm"><span>union_unindexed_fold</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="keyword1"><span>§fold</span></span><span> </span><span class="bound"><span>X</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>X0</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>!</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>X</span></span><span> </span><span class="main"><span>∪</span></span><span> </span><span class="free"><span>F</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>X0</span></span><span> </span><span class="main"><span>∪</span></span><span> </span><span class="main"><span>⋃</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span class="free"><span>F</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span>set</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>}</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>subst</span></span><span> </span><a class="entity_ref" href="General.html#General.union_indexed_fold|fact"><span>union_indexed_fold</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><span>in_set_conv_nth</span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹</span><span>Other</span><span>›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>type_synonym</span></span></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span class="main"><span>,</span></span><span> </span><span class="tfree"><span>'b</span></span><span class="main"><span>)</span></span><span> </span><span class="entity_def" id="General.map|type"><span>map</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span> </span><span>option</span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="General.map_forced_get_def|fact"><span class="entity_def" id="General.map_forced_get_def|thm"><span class="entity_def" id="General.map_forced_get_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="General.map_forced_get|const"><span>map_forced_get</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span class="main"><span>,</span></span><span> </span><span class="tfree"><span>'b</span></span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="General.html#General.map|type"><span>map</span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span>"</span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>infixl</span></span></span><span> </span><span class="quoted"><span>"</span><span class="keyword1"><span>!!</span></span><span>"</span></span><span> 100</span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="bound"><span class="entity"><span>m</span></span></span></span><span> </span><span class="main"><span class="free"><span>!!</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>the</span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>m</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> 

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span></pre>
</body>

</html>